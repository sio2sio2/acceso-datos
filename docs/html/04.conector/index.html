


<!DOCTYPE html>


<html lang="es" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4. Conectores a bases de datos relacionales &#8212; documentación de Acceso a datos - rolling</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" href="../_static/general.css" type="text/css" />
    <link rel="stylesheet" href="../_static/particular.css" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=461dccb6"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=677778c1"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/translations.js?v=d190bf04"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '04.conector/index';</script>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="Apéndices" href="../98.apendices/index.html" />
    <link rel="prev" title="3.3. BaseX" href="../03.xml/03.basex.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="es"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Saltar al contenido principal</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Volver arriba</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Advertencia de versión"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.jpg" class="logo__image only-light" alt="documentación de Acceso a datos - rolling - Home"/>
    <script>document.write(`<img src="../_static/logo.jpg" class="logo__image only-dark" alt="documentación de Acceso a datos - rolling - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Búsqueda" aria-label="Búsqueda" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Búsqueda</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01.archivos/index.html">1. Tratamiento de archivos</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../01.archivos/01.gestion.html">1.1. Gestión de archivos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01.archivos/02.manipulacion.html">1.2. Consulta y manipulación de contenidos</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02.formatos/index.html">2. Formatos de información</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02.formatos/01.csv.html">2.1. <abbr title="Comma-Separated Values">CSV</abbr></a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../02.formatos/02.json.html">2.2. <abbr title="JavaScript Object Notation">JSON</abbr></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../02.formatos/02.json/01.gson.html">2.2.1. GSON</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02.formatos/02.json/02.jackson.html">2.2.2. Jackson</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../02.formatos/03.yaml.html">2.3. <abbr title="YAML Ain't Markup Language">YAML</abbr></a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../03.xml/index.html">3. <abbr title="eXtensible Markup Language">XML</abbr></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../03.xml/01.jaxp.html">3.1. <abbr title="Java API for XML Processing">JAXP</abbr></a></li>
<li class="toctree-l2"><a class="reference internal" href="../03.xml/02.jackson.html">3.2. Jackson</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03.xml/03.basex.html">3.3. BaseX</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">4. Conectores a bases de datos relacionales</a></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../98.apendices/index.html">Apéndices</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../98.apendices/01.funcional.html">Java funcional</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../98.apendices/01.funcional/01.function.html">Interfaces funcionales</a></li>
<li class="toctree-l3"><a class="reference internal" href="../98.apendices/01.funcional/05.collection.html">Colecciones</a></li>
<li class="toctree-l3"><a class="reference internal" href="../98.apendices/01.funcional/10.flujos.html">Flujos</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../98.apendices/99.ide.html">Entorno de desarrollo</a></li>
</ul>
</details></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../99.ejercicios/01.achivos.html">Ejercicios sobre archivos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../99.ejercicios/02.formatos.html">Ejercicios sobre formatos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../99.ejercicios/03.xml.html">Ejercicios sobre formato <abbr title="eXtensible Markup Language">XML</abbr></a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Descarga esta pagina">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/04.conector/index.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Descargar archivo fuente"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Imprimir en PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Modo de pantalla completa"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="claro/oscuro" aria-label="claro/oscuro" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Búsqueda" aria-label="Búsqueda" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Conectores a bases de datos relacionales</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenido </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aperitivo">4.1. Aperitivo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conexion">4.2. Conexión</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ejecucion-de-sentencias">4.3. Ejecución de sentencias</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simples">4.3.1. Simples</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parametrizadas">4.3.2. Parametrizadas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#datos">4.4. Datos</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#datos-simples">4.4.1. Datos simples</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#datos-complejos">4.4.2. Datos complejos</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fechas-y-tiempos">4.4.2.1. Fechas y tiempos</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#blob-y-clob">4.4.2.2. BLOB y CLOB</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#json">4.4.2.3. JSON</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#array-y-struct">4.4.2.4. ARRAY y STRUCT</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transacciones">4.5. Transacciones</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manejo-de-transacciones">4.5.1. Manejo de transacciones</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#operaciones-masivas">4.5.2. Operaciones masivas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extras">4.6. Extras</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tratamiento-funcional-de-las-consultas">4.6.1. Tratamiento funcional de las consultas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pool-de-conexiones">4.6.2. <em>Pool</em> de conexiones</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metadatos">4.6.3. Metadatos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gestor-de-transacciones">4.6.4. Gestor de transacciones</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cargar-esquema-desde-archivo">4.6.5. Cargar esquema desde archivo</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="conectores-a-bases-de-datos-relacionales">
<span id="conn"></span><h1><span class="section-number">4. </span>Conectores a bases de datos relacionales<a class="headerlink" href="#conectores-a-bases-de-datos-relacionales" title="Link to this heading">#</a></h1>
<p>Las bases de datos relacionales son unos de los mecanismos más utilizados para
el almacenamiento organizado de información. Su problema, al ser accedidas
mediante aplicaciones es que basan su estructrura en el modelo relacional, que
no es el modelo que usan los lenguajes de programación para manejar datos. En
concreto, los más habituales, los lenguajes de <abbr title="Programación Orientada a Objetos">POO</abbr> manejan los datos haciendo
uso del modelo de objetos por lo que existe una discrepación entre el modo en
que tratan los datos los <abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr> relacionales y el modo en que los tratan los
lenguajes. Para afrontarlo los lenguajes utilizan dos estrategias distintas:</p>
<ol class="arabic simple">
<li><p>El uso de conectores, en que el acceso a la base de datos se realiza mediante
sentencias <abbr title="Structured Query Language">SQL</abbr> y la traducción del modelo relacional al modelo de objetos
corre a cargo del programador.</p></li>
<li><p>El uso de herramientas <abbr title="Object-Relational Mapping">ORM</abbr> en que la traducción entre ambos modelos corre a
cargo de la propia herramienta siguiendo las orientaciones del programador.</p></li>
</ol>
<p>Podemos entender mejor estas dos estrategias, si las comparamos con estrategias
ya vistas anteriormente para acceder a otros soportes de datos:</p>
<ul class="simple">
<li><p>La primera estrategia es la misma que sigue la librería <a class="reference external" href="https://commons.apache.org/proper/commons-csv/project-info.html">commons-csv</a> para leer
y escribir <abbr title="Comma-Separated Values">CSV</abbr>.</p></li>
<li><p>La segunda estrategia es la que sigue la <a class="reference external" href="https://github.com/FasterXML/jackson">librería Jackson</a> para leer y
escribir distintos formatos.</p></li>
</ul>
<p>Ambas estrategias tienen sus <strong>ventajas</strong> e <strong>inconvenientes</strong>:</p>
<dl class="simple">
<dt><strong>Ventajas</strong> de los conectores</dt><dd><ol class="loweralpha simple">
<li><p>Mayor control sobre las operaciones, al definirse manualmente, lo que
permite ajustar más la solución al problema concreto o utilizar
características avanzadas de <abbr title="Structured Query Language">SQL</abbr>.</p></li>
<li><p>Al haber menos abstracción, suele ser una estrategia de mayor rendimiento.</p></li>
<li><p>Es una solución más fácilmente depurable.</p></li>
<li><p>Las sentencias <abbr title="Structured Query Language">SQL</abbr> son independientes del lenguaje de programación en que
se escriba la aplicación, pese a lo cual habrá que traducir el código al
nuevo lenguaje.</p></li>
<li><p>Son más sencillos de usar que un <abbr title="Object-Relational Mapping">ORM</abbr>.</p></li>
<li><p>Los conectores suelen formar parte de las librerías básicas del lenguaje
por lo que no necesitaremos usar una librería de terceros (la librería
<abbr title="Object-Relational Mapping">ORM</abbr>) ni tendremos que reescribir el código si decidimos cambiar a un
<abbr title="Object-Relational Mapping">ORM</abbr> distinto.</p></li>
</ol>
</dd>
<dt><strong>Ventajas</strong> de las herramientas <abbr title="Object-Relational Mapping">ORM</abbr></dt><dd><ol class="loweralpha simple">
<li><p>Al proveer un mecanismo para traducir el modelo relacional al modelo de
datos del lenguaje de programación (modelo de objetos), son herramientas
más productivas.</p></li>
<li><p>El programador trata los datos directamente como objetos lo que hace el
código más sencillo y manipulable.</p></li>
<li><p>Generalmente, cambiar de <abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr> es trivial, puesto que la herramienta
nos abstrae de sus particularidades. Su uso, por tanto, nos independencia
de cuál sea el <abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr> que gestione los datos frente a los conectores que
usan sentencias <abbr title="Structured Query Language">SQL</abbr>, generalmente dependientes de cuál es el <abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr>. En
contrapartida, puede resultar muy trabajoso cambiar de <abbr title="Object-Relational Mapping">ORM</abbr></p></li>
</ol>
</dd>
</dl>
<p>En esta unidad abordaremos la primera estrategia y dejaremos la segunda para la
<span class="xref std std-ref">unidad siguiente</span>.</p>
<p>Java proporciona para el acceso a bases de datos relacionales una <abbr title="Application Programming Interface">API</abbr> en su
<abbr title="Java Development Kit">JDK</abbr> llamada <abbr title="Java DataBase Connectivity">JDBC</abbr>, lo que posibilita que el acceso sea idéntico sea cual sea
el <abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr> que se decida utilizar. Esto no significa que el código sea
independiente del motor subyacente, puesto que cada motor tiene sus
particularidades que extienden el <abbr title="Structured Query Language">SQL</abbr> estándar y esta estrategia, al estar
basada en la construcción de sentencias <abbr title="Structured Query Language">SQL</abbr>, nos obliga a utilizarlas. Lo que
en realidad es común son los métodos que proporciona Java para ordenar la
ejecución de las sentencias al motor de la base de datos. Además de la
<abbr title="Application Programming Interface">API</abbr>, necesitaremos para cada <abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr> un <em>driver</em> basado en la <abbr title="Application Programming Interface">API</abbr> que
posibilite la conexión. Este <em>driver</em> sí que será una librería de terceros que
deberemos incluir en nuestro proyecto.</p>
<section id="aperitivo">
<h2><span class="section-number">4.1. </span>Aperitivo<a class="headerlink" href="#aperitivo" title="Link to this heading">#</a></h2>
<p>Para aprender y practicar el acceso con conectores, podemos escoger cualquier
<abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr>. Utilizaremos en el caso de estos apuntes, <a class="reference external" href="https://sqlite.org/">SQLite</a> por varias razones:</p>
<ul class="simple">
<li><p>Comodidad, ya que a diferencia de otros (<a class="reference external" href="https://mariadb.org/">MariaDB</a>, <a class="reference external" href="https://www.oracle.com/es/database/">Oracle</a>, etc) no requiere
un servidor: la base de datos es un archivo.</p></li>
<li><p>Es una base de datos empotrada y se usa mucho en aplicaciones que necesitan
organizar sus datos en una base de datos exclusiva en la que no
concurrirán otros procesos.</p></li>
</ul>
<p>Con la excepción de las propias sentencias <abbr title="Structured Query Language">SQL</abbr> que pueden variar de <abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr> o
<abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr>, las explicaciones serán totalmente válidas. Antes, no obstante, es
necesario que tengamos <strong>instalado el motor</strong>. En el caso de <strong class="program">SQLite</strong>:</p>
<ul id="rst-simple">
<li><p>Las distribuciones de <em>Linux</em> suelen incluir un paquete por lo que su
instalación es trivial.</p></li>
<li><p>Para sistemas <em>Windows</em> la página oficial ofrece <a class="reference external" href="https://sqlite.org/download.html#win32">binarios precompilados</a>, pero no un instalador automático.
La instalación, no obstante, es sencilla:</p>
<p>a. Guardar los archivos suministrados dentro del <em>zip</em> en un lugar adecuado
(p.e. <code class="file docutils literal notranslate"><span class="pre">C:\Program</span> <span class="pre">Files\SQLite</span></code>).
#. Añadir el directorio al <cite>PATH</cite> del sistema.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Procuramos escribir sentencias <abbr title="Structured Query Language">SQL</abbr> que cumplan el estándar para que
el código sea lo más portable posible.</p>
</div>
<p>Además, necesitaremos importar en nuestro proyecto la librería propia de <strong class="program">SQLite</strong>: <a class="reference external" href="https://mvnrepository.com/artifact/org.xerial/sqlite-jdbc">sqlite-jdbc</a>.</p>
<p class="rubric">Ejercicio ilustrativo</p>
<p>Tomemos como base el <a class="reference internal" href="../03.xml/index.html#xml"><span class="std std-ref">ejercicio ilustrativo con que introducimos XML</span></a>, aunque con algunos cambios (generalizaciones):</p>
<ul class="simple">
<li><p>Puede haber varios claustros.</p></li>
<li><p>Un mismo profesor puede trabajar en varios claustro diferentes.</p></li>
<li><p>Si se da la anterior circunstancia, el profesor se adcribirá a un
departamento<a class="footnote-reference brackets" href="#id8" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> por centro, pero no tiene que ser para todos los centros el
mismo.</p></li>
<li><p>De igual modo, en un centro puede tener asignado uno o varios casilleros
distintos a los que tiene en otro.</p></li>
</ul>
<p>Esto podemos representarlo gráficamente con el siguente diagrama <abbr title="Entidad/Relación">E/R</abbr>:</p>
<img alt="../_images/ER-problema.png" src="../_images/ER-problema.png" />
<p>Podemos traducir el anterior esquema al modelo relacional así:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Centro(*idCentro*, nombre)
Profesor(*idProfesor*, casillero, sustituye, apelativo, apellidos, nombre)
Departamento(*idDepartamento*, denominacion)
Trabaja(*idProfesor, idCcentro*, departamento)
</pre></div>
</div>
</section>
<section id="conexion">
<span id="conn-conexion"></span><h2><span class="section-number">4.2. </span>Conexión<a class="headerlink" href="#conexion" title="Link to this heading">#</a></h2>
<p>Lo primero que debemos aprender es cómo abrir una conexión a la base de datos:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jdbc:sqlite:&quot;</span><span class="p">;</span>
</span>
<span class="c1">// Las bases de datos de SQLite son archivos.</span>
<span class="n">Path</span><span class="w"> </span><span class="n">dbPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Path</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="s">&quot;java.io.tmpdir&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;test.db&quot;</span><span class="p">);</span>
<span class="hll"><span class="n">String</span><span class="w"> </span><span class="n">dbUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%s%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dbProtocol</span><span class="p">,</span><span class="w"> </span><span class="n">dbPath</span><span class="p">);</span>
</span>
<span class="c1">// Alternativa particular de SQLite: base de datos en memoria.</span>
<span class="c1">//String dbUrl = String.format(&quot;%s%s&quot;, dbProtocol, &quot;:memory:&quot;);</span>

<span class="k">try</span><span class="w"> </span><span class="p">(</span>
<span class="hll"><span class="w">   </span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">dbUrl</span><span class="p">,</span><span class="w"> </span><span class="cm">/* usuario */</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="cm">/* contraseña */</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Hemos logrado conectar a la base de datos&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">System</span><span class="p">.</span><span class="na">err</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Error de conexión. &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">err</span><span class="p">.</span><span class="na">getMessage</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>En el código de ejemplo, hay dos claves fundamentales:</p>
<ul>
<li><p>La <abbr title="Uniform Resource Locator">URL</abbr> de conexión que se compone, a su vez de:</p>
<ul class="simple">
<li><p>El protocolo que identifica al <abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr></p></li>
<li><p>La indicación de la base de datos a la que queremos conectar.</p></li>
</ul>
<p>Esta <abbr title="Uniform Resource Locator">URL</abbr> depende del <abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr>, así que tendremos que tener presente cuál
estamos utilizando al construirla:</p>
<div class="pst-scrollable-table-container"><table class="url-sql table">
<thead>
<tr class="row-odd"><th class="head"><p><abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr></p></th>
<th class="head"><p>Librería <abbr title="Java DataBase Connectivity">JDBC</abbr></p></th>
<th class="head"><p><abbr title="Uniform Resource Locator">URL</abbr><a class="footnote-reference brackets" href="#id9" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SQLite</p></td>
<td><p><a class="reference external" href="https://mvnrepository.com/artifact/org.xerial/sqlite-jdbc">sqlite-jdbc</a></p></td>
<td><p><cite>jdbc:sqlite:&lt;ruta&gt;</cite></p></td>
</tr>
<tr class="row-odd"><td><p>MariaDB</p></td>
<td><p><a class="reference external" href="https://mvnrepository.com/artifact/org.mariadb.jdbc/mariadb-java-client">mariadb-java-client</a></p></td>
<td><p><cite>jdbc:mariadb://[&lt;host&gt;[:&lt;port&gt;]]/&lt;base_datos&gt;</cite></p></td>
</tr>
<tr class="row-even"><td><p>MySQL</p></td>
<td><p><a class="reference external" href="https://mvnrepository.com/artifact/com.mysql/mysql-connector-j">mysql-connector-j</a></p></td>
<td><p><cite>jdbc:mysql://[&lt;host&gt;[:&lt;port&gt;]]/[base_datos]</cite></p></td>
</tr>
<tr class="row-odd"><td><p>PostgreSQL</p></td>
<td><p><a class="reference external" href="https://mvnrepository.com/artifact/org.postgresql/postgresql">postgresql</a></p></td>
<td><p><cite>jdbc:postgresql://[&lt;host&gt;[:&lt;port&gt;]]/&lt;base_datos&gt;</cite></p></td>
</tr>
<tr class="row-even"><td><p>Oracle</p></td>
<td><p><a class="reference external" href="https://mvnrepository.com/artifact/com.oracle.database.jdbc/ojdbc11">ojdbc11</a></p></td>
<td><p><cite>jdbc:oracle:thin:&#64;//&lt;host&gt;[:&lt;port&gt;]/&lt;SID/ServerName&gt;</cite></p></td>
</tr>
<tr class="row-odd"><td><p>SQL Server</p></td>
<td><p><a class="reference external" href="https://mvnrepository.com/artifact/com.microsoft.sqlserver/mssql-jdbc">mssql-jdbc</a></p></td>
<td><p><cite>jdbc:sqlserver://&lt;host&gt;[:&lt;port&gt;];databaseName=&lt;base_datos&gt;</cite></p></td>
</tr>
</tbody>
</table>
</div>
</li>
<li><p>El objeto de conexión, creado con las estructura <em>try-with-resources</em>, para que se cierre automáticamente. Al crear el objeto
es necesario facilitar la <abbr title="Uniform Resource Locator">URL</abbr>, y un usuario y una contraseña con permisos
para realizar las operaciones que se desee llevar acabo.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Como <strong class="program">SQLite</strong> no define permisos para usuarios, sólo es
necesaria la <abbr title="Uniform Resource Locator">URL</abbr>. Se ha dejado explícita esta falta de necesidad, pero
podríamos haber definido el método ahorrándonos los dos argumentos:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">dbUrl</span><span class="p">);</span>
</pre></div>
</div>
</div>
</li>
</ul>
<p>Por supuesto, el código es <em>completamente inútil</em>: nos hemos conectado a la base
de datos para no hacer absolutamente nada. En los siguientes apartados veremos
como leer y escribir datos.</p>
</section>
<section id="ejecucion-de-sentencias">
<span id="conn-statement"></span><h2><span class="section-number">4.3. </span>Ejecución de sentencias<a class="headerlink" href="#ejecucion-de-sentencias" title="Link to this heading">#</a></h2>
<p>El acceso mediante conectores se basa en la ejecución de sentencias <abbr title="Structured Query Language">SQL</abbr> que
pueden ser de dos tipos:</p>
<ul class="simple">
<li><p>Sentencias que modifican la base de datos.</p></li>
<li><p>Sentencias que obtienen datos sin llevar a cabo modificación alguna.</p></li>
</ul>
<p>A partir de un objeto <a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/Statement.html">Statement</a>, para las primeras se
usa el método <code class="docutils literal notranslate"><span class="pre">executeUpdate</span></code>, mientras que para las segundas el método
<code class="docutils literal notranslate"><span class="pre">executeQuery</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Hay otro método, <code class="docutils literal notranslate"><span class="pre">execute</span></code> que sirve para ambos casos y que devuelve
<code class="docutils literal notranslate"><span class="pre">true</span></code>, si hay resultados (segundo caso) o <code class="docutils literal notranslate"><span class="pre">false</span></code>, si no los hay.
Como lo normal es que se sepa de antemano si la sentencia devuelve datos o no
(p.e. un <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> devuelve datos; un <code class="docutils literal notranslate"><span class="pre">INSERT</span></code>, no), podemos prescindir de
ella.</p>
</div>
<section id="simples">
<h3><span class="section-number">4.3.1. </span>Simples<a class="headerlink" href="#simples" title="Link to this heading">#</a></h3>
<p>Comencemos creado cuatro tablas:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;jdbc:sqlite:&quot;</span><span class="p">;</span>

<span class="n">String</span><span class="w"> </span><span class="n">dbUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%s%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">dbProtocol</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;:memory:&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// Base de datos en la memoria</span>

<span class="k">try</span><span class="w"> </span><span class="p">(</span>
<span class="w">   </span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
<span class="w">   </span><span class="n">Statement</span><span class="w"> </span><span class="n">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">createStatement</span><span class="p">();</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">   </span><span class="c1">// Particular de SQLite: respetar la integredad referencial (opcional).</span>
<span class="w">   </span><span class="n">stmt</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="s">&quot;PRAGMA foreign_keys = ON&quot;</span><span class="p">);</span>

<span class="w">   </span><span class="c1">// Tabla Departamento.</span>
<span class="w">   </span><span class="n">stmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      CREATE TABLE Departamento (</span>
<span class="s">         id_departamento   INTEGER PRIMARY KEY /* GENERATED BY DEFAULT AS IDENTITY */,</span>
<span class="s">         denominacion      VARCHAR(50)    NOT NULL</span>
<span class="s">      );</span>
<span class="s">   &quot;&quot;&quot;</span><span class="p">);</span>

<span class="w">   </span><span class="c1">// Tabla Centro</span>
<span class="w">   </span><span class="n">stmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      CREATE TABLE Centro (</span>
<span class="s">         id_centro         INTEGER        PRIMARY KEY /* GENERATED BY DEFAULT AS IDENTITY */,</span>
<span class="s">         nombre            VARCHAR(100)   NOT NULL</span>
<span class="s">      );</span>
<span class="s">   &quot;&quot;&quot;</span><span class="p">);</span>

<span class="w">   </span><span class="c1">// Tabla Profesor.</span>
<span class="w">   </span><span class="n">stmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      CREATE TABLE Profesor (</span>
<span class="s">         id_profesor       INTEGER        PRIMARY KEY /* GENERATED BY DEFAULT AS IDENTITY */,</span>
<span class="s">         apelativo         VARCHAR(50)    NOT NULL,</span>
<span class="s">         nombre            VARCHAR(75)    NOT NULL,</span>
<span class="s">         apellidos         VARCHAR(150)   NOT NULL,</span>
<span class="s">         sustituye         INTEGER        UNIQUE DEFAULT NULL,</span>

<span class="s">         CONSTRAINT fk_pro_pro FOREIGN KEY(sustituye) REFERENCES Profesor(id_profesor)</span>
<span class="s">            ON DELETE SET NULL</span>
<span class="s">            ON UPDATE CASCADE</span>
<span class="s">      );</span>
<span class="s">   &quot;&quot;&quot;</span><span class="p">);</span>

<span class="w">   </span><span class="c1">// Relación Profesor-Centro.</span>
<span class="w">   </span><span class="n">stmt</span><span class="p">.</span><span class="na">executaUpdate</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      CREATE TABLE Trabaja (</span>
<span class="s">         profesor          INTEGER,</span>
<span class="s">         centro            INTEGER,</span>
<span class="s">         departamento      INTEGER,</span>
<span class="s">         -- Para permitir que un mismo profesor tenga varios casilleros.</span>
<span class="s">         casillero         INTEGER ARRAY    NOT NULL,</span>
<span class="s">         </span>
<span class="s">         CONSTRAINT pk_tra     PRIMARY KEY(profesor, centro),</span>
<span class="s">         CONSTRAINT fk_tra_pro FOREIGN KEY(profesor) REFERENCES Profesor(id_profesor)</span>
<span class="s">            ON DELETE CASCADE</span>
<span class="s">            ON UPDATE CASCADE,</span>
<span class="s">         CONSTRAINT fk_tra_cla FOREIGN KEY(centro) REFERENCES Centro(id_centro)</span>
<span class="s">            ON DELETE CASCADE</span>
<span class="s">            ON UPDATE CASCADE,</span>
<span class="s">         CONSTRAINT fk_est_dep FOREIGN KEY(&quot;departamento&quot;) REFERENCES Departamento(id_departamento)</span>
<span class="s">            ON DELETE SET NULL</span>
<span class="s">            ON UPDATE CASCADE</span>
<span class="s">      );</span>
<span class="s">   &quot;&quot;&quot;</span><span class="p">);</span>

<span class="w">   </span><span class="c1">// Trigger para evitar que un sustituto pueda aparecer en Trabaja,</span>
<span class="w">   </span><span class="c1">// ya que su trabajo debe ser el del titular. ESTO NO ES ESTÁNDAR.</span>

<span class="w">   </span><span class="n">stmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      CREATE TRIGGER NoSustitutoEnTrabaja</span>
<span class="s">      BEFORE INSERT ON Trabaja</span>
<span class="s">      FOR EACH ROW</span>
<span class="s">      WHEN (SELECT sustituye FROM Profesor WHERE id_profesor = NEW.profesor) IS NOT NULL</span>
<span class="s">      BEGIN</span>
<span class="s">         SELECT RAISE(FAIL, &#39;Imposible registrar un sustituto en Trabaja: hace la misma labor que el sustituido.&#39;);</span>
<span class="s">      END;</span>
<span class="s">   &quot;&quot;&quot;</span><span class="p">);</span>

<span class="w">   </span><span class="c1">// Más sentencias que ya veremos.</span>
<span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">err</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">   </span><span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>El código tiene dos aspectos:</p>
<ol class="arabic">
<li><p>Las sentencias <abbr title="Structured Query Language">SQL</abbr> que son sentencias <abbr title="Structured Query Language">SQL</abbr> cuya comprensión no
forma parte de los objetivos de esta unidad<a class="footnote-reference brackets" href="#id10" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>, así que no entraremos en
comentarlas.</p>
<div class="admonition hint">
<p class="admonition-title">Consejo</p>
<p>No obstante si conviene precisar que procuremos al escribirlas
ceñirnos al estándar lo más posible a fin de que sean lo más universales
posibles y nos sea menos costoso cambiar de <abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr>. A este respecto:</p>
<ul class="simple">
<li><p>Dejamos de escribir los nombres de elementos de la base de datos
(tablas, columnas) entre comillas dobles, porque el estándar <abbr title="Structured Query Language">SQL</abbr> lo
permite en caso de que los nombres no contengan caracteres “raros”
(espacios, etc.) o no se tenga la intención de distinguir nombres
cambiando entre mayúsculas y minúsculas (p.e. que una tabla se llame
<em>Persona</em> y otra distinta <em>persona</em> o <em>PERSONA</em>)<a class="footnote-reference brackets" href="#id11" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>.</p></li>
<li><p>Escribimos para los tipos los nombres que define el estándar.</p></li>
<li><p>Las cadenas se encierran entre comillas simples.</p></li>
</ul>
</div>
</li>
<li><p>La ejecución de esas sentencias usando <abbr title="Java DataBase Connectivity">JDBC</abbr>. Obsérvese que:</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>Reaprovechamos el mismo objeto <a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/Statement.html">Statement</a> para
ejecutarlas todas.</p></li>
<li><p>Las ejecutamos usando el método <code class="docutils literal notranslate"><span class="pre">executeUpdate</span></code>, puesto que su función es
modificar el contenido de la base de datos, no obtener información.</p></li>
</ul>
</div></blockquote>
<p>Tampoco las sentencias de inserción devuelven resultados, por lo que también
podemos hacer:</p>
<div class="highlight-java notranslate" id="ej-insert-sin-par"><div class="highlight"><pre><span></span><span class="c1">// Agregamos algunos departamentos.</span>
<span class="n">stmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">(</span><span class="s">&quot;INSERT INTO Departamento (denominacion) VALUES (&#39;Informática&#39;)&quot;</span><span class="p">);</span>
<span class="k">for</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">denominacion</span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Inglés&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Francés&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Tecnología&quot;</span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">stmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;INSERT INTO Departamento (denominacion) VALUES (&#39;%s&#39;);&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">denominacion</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition caution">
<p class="admonition-title">Prudencia</p>
<p>Aún estamos empezando y sabemos poco así que estas sentencias son
torpes por dos razones:</p>
<ul class="simple">
<li><p>Estamos ejecutando repetidamente (cuatro veces) la misma sentencia y no es
eficiente. Ya aprenderemos cómo hacer <a class="reference internal" href="#conn-batch"><span class="std std-ref">operaciones masivas</span></a>.</p></li>
<li><p>Las sentencias usan valores almacenados en variables y hay que construirlas
incluyendo esos valores dentro de las sentencias. Para ello nosotros hemos
usado <code class="docutils literal notranslate"><span class="pre">String.format</span></code>. Sin embargo, <abbr title="Java DataBase Connectivity">JDBC</abbr> ya viene con un mecanismo
específico para realizar esta labor: las <a class="reference internal" href="#conn-preparedstatement"><span class="std std-ref">sentencias parametrizadas</span></a>.</p></li>
</ul>
<p>Por tanto, no tome estos ejemplos muy en serio. Ya aprenderá a escribirlos
mejor.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Se proporcionan adicionalmente dos guiones para su uso directo con
<strong class="program">SQLite</strong>: <a class="reference download internal" download="" href="../_downloads/32df3fa3409385265d36cc032c9ffcd4/sustituye.sql"><code class="xref download docutils literal notranslate"><span class="pre">sustituye.sql</span></code></a>, que
implementa la solución desarrollada aquí y <a class="reference download internal" download="" href="../_downloads/4bd5718b49155d3fba839e92b3045bc5/sustituto.sql"><code class="xref download docutils literal notranslate"><span class="pre">sustituto.sql</span></code></a> en que el campo <em>sustituye</em> se cambia por <em>sustituto</em>
para que su significado sea quién es el sustituto del profesor en vez de a
quién sustituye el profesor. En ambas soluciones, al código Java mostrado se
añaden algunos <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> para agregar registros a la base de datos y se
define una <abbr title="Common Table Expression">CTE</abbr> recursiva (totalmente compatible con el estándar <abbr title="Structured Query Language">SQL</abbr>) para
que la propia base de datos nos cree una vista (<em>PlantillaFuncionamiento</em>)
que muestra cada profesor, a qué titular en último caso sustituye (o él mismo
si es titular) y si está activo o no. Esta vista es de enorme utilidad para
saber en dónde trabaja cada profesor, ya que la tabla <em>Trabaja</em> sólo contiene
profesores titulares.</p>
</div>
<p class="rubric">Consultas</p>
<p>Las consultas, en cambio, sí devuelven resultados, que deberán procesarse luego:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span><span class="s">&quot;SELECT * FROM Departamento;&quot;</span><span class="p">);</span>

<span class="k">while</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="s">&quot;id_departamento&quot;</span><span class="p">);</span>
<span class="w">     </span><span class="n">String</span><span class="w"> </span><span class="n">denominacion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;denominacion&quot;</span><span class="p">);</span>
<span class="w">     </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;ID: %d  -- nombre: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">denominacion</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Como se ilustra arriba, el resultado de las consultas se obtiene a través de un
objeto <a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/ResultSet.html">ResultSet</a> que se va consumiendo a medida que obtenemos registros de él.
En el ejemplo, nos hemos limitado a imprimirlos, pero si nuestro programa
pretendiera hacer algo útil, tendríamos que trasladar esta información al modelo
de objetos de Java, Por ejemplo, suponiendo que hubiéramos definido una clase
<code class="docutils literal notranslate"><span class="pre">Departamento</span></code> así:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * Esto en realidad se debería comportar como un Enum. Podríamos redefinir la</span>
<span class="cm"> * clase, para que tuviera ese comportamiento y al cargar los datos de la tabla,</span>
<span class="cm"> * impidiera crear más objetos.</span>
<span class="cm"> */</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Departamento</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">denominacion</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Departamento</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kd">super</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Departamento</span><span class="w"> </span><span class="nf">cargarDatos</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">denominacion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">setId</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="w">        </span><span class="n">setDenominacion</span><span class="p">(</span><span class="n">denominacion</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setId</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getDenominacion</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">denominacion</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setDenominacion</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">denominacion</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">denominacion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">denominacion</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>podríamos hacer esto:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span><span class="s">&quot;SELECT * FROM Departamento&quot;</span><span class="p">);</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">Departamento</span><span class="o">&gt;</span><span class="w"> </span><span class="n">departamentos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

<span class="k">while</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="s">&quot;idDepartamento&quot;</span><span class="p">);</span>
<span class="w">     </span><span class="n">String</span><span class="w"> </span><span class="n">denominacion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;denominacion&quot;</span><span class="p">);</span>
<span class="w">     </span><span class="n">departamentos</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Departamento</span><span class="p">().</span><span class="na">cargarDatos</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">denominacion</span><span class="p">));</span>
<span class="w">     </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;ID: %d  -- nombre: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">denominacion</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Importante</p>
<p>Obsérvese que tiene que ser el programador el que traduzca el modelo
relacional al modelo de objetos, tal como adelantamos en la introducción.</p>
</div>
</section>
<section id="parametrizadas">
<span id="conn-preparedstatement"></span><h3><span class="section-number">4.3.2. </span>Parametrizadas<a class="headerlink" href="#parametrizadas" title="Link to this heading">#</a></h3>
<p>Las sentencias, tanto las de manipulación como las de consultas, requieren en
muchos casos que se incluyan valores de variables en las propias sentencias
(véase, sin ir más lejos, el <a class="reference internal" href="#ej-insert-sin-par"><span class="std std-ref">ejemplo de inserción bajo el epígrafe
anterior</span></a>.). Por este motivo los conectores incluyen un
mecanismo para parametrizar sentencias; y, en el caso de <abbr title="Java DataBase Connectivity">JDBC</abbr>, se hace uso de
<a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/PreparedStatement.html">PreparedStatement</a>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">(</span>
<span class="hll"><span class="w">   </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">pstmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="s">&quot;INSERT INTO Departamento (denominacion) VALUES (?)&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span class="hll"><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">denominacion</span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Informática&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Inglés&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Tecnología&quot;</span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
</span><span class="w">        </span><span class="n">pstmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">denominacion</span><span class="p">);</span><span class="w">  </span><span class="c1">// 1: Valor para el primer &quot;?&quot;.</span>
<span class="w">        </span><span class="n">pstmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>
<span class="hll"><span class="w">    </span><span class="p">}</span>
</span><span class="hll"><span class="p">}</span>
</span></pre></div>
</div>
<p>Por tanto, cuando se ejecutan sentencias parametrizadas, hay que definir el
valor para todos los parámetros (el primero, el segundo, etc.) y cuando se han
establecidos todos sus valores, ejecutar la sentencia.</p>
<div class="admonition caution">
<p class="admonition-title">Prudencia</p>
<p>Pero no hemos dado aún con la forma eficiente, ya que estamos
repitiendo la ejecución de la misma sentencia con distintos valores y lo que
hemos hecho no es en absoluto eficiente. Necesitaremos <a class="reference internal" href="#conn-batch"><span class="std std-ref">más adelante</span></a>, darle al menos una vuelta más.</p>
</div>
<p>Obsérvese que al definir los valores de los parámetros de una consulta,
necesitamos cambiar de método según sea el tipo del campo:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">(</span>
<span class="w">   </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">pstmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="s">&quot;INSERT INTO Profesor (apelativo, nombre, apellidos, sustituye) VALUES (?, ?, ?, ?)&quot;</span><span class="p">);</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">pstmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Manolo&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">pstmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Manuel&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">pstmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Peñalba Pinzón&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">pstmt</span><span class="p">.</span><span class="na">setNull</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="n">Types</span><span class="p">.</span><span class="na">INTEGER</span><span class="p">);</span>
<span class="w">      </span><span class="n">pstmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p><abbr title="Java DataBase Connectivity">JDBC</abbr> permite usar un método genérico (<code class="docutils literal notranslate"><span class="pre">setObject</span></code>) que se encargará de
inferir el tipo <abbr title="Structured Query Language">SQL</abbr> correcto a partir del tipo de <em>Java</em>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">(</span>
<span class="w">   </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">pstmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      INSERT INTO &quot;Profesor&quot; (&quot;apelativo&quot;, &quot;nombre&quot;, &quot;apellidos&quot;, &quot;sustituye&quot;) VALUES</span>
<span class="s">         (?, ?, ?, ?);</span>
<span class="s">   &quot;&quot;&quot;</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">pstmt</span><span class="p">.</span><span class="na">setObject</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Manolo&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">pstmt</span><span class="p">.</span><span class="na">setObject</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Manuel&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">pstmt</span><span class="p">.</span><span class="na">setObject</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Peñalba Pinzón&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">pstmt</span><span class="p">.</span><span class="na">setObject</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">Types</span><span class="p">.</span><span class="na">INTEGER</span><span class="p">);</span><span class="w">  </span><span class="c1">// No se puede inferir entero a partir de null</span>
<span class="w">      </span><span class="n">pstmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>El problema de <code class="docutils literal notranslate"><span class="pre">setObject</span></code> es que delegar la elección del tipo en el conector penaliza el
rendimiento.</p>
</section>
</section>
<section id="datos">
<span id="conn-data"></span><h2><span class="section-number">4.4. </span>Datos<a class="headerlink" href="#datos" title="Link to this heading">#</a></h2>
<p>Hasta ahora no nos hemos detenido en las particularidades de los tipos de datos,
ya que los que muestran nuestro ejemplo son bastante simples. Sin embargo, la
correspondencia entre tipos de datos de Java y de <abbr title="Structured Query Language">SQL</abbr> no es exacta, por lo que
<abbr title="Java DataBase Connectivity">JDBC</abbr> implementa los métodos <cite>setXXXX</cite> de <a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/PreparedStatement.html">PreparedStatement</a> para guardar
datos en la base de datos y los métodos <cite>getXXXX</cite> de <a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/ResultSet.html">ResultSet</a> para
recuperarlos.</p>
<p>En principio (aunque hay excepciones), podemos usar estos métodos y abstraernos
de cómo implementa el tipo el <abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr> el estándar <abbr title="Structured Query Language">SQL</abbr>.</p>
<section id="datos-simples">
<span id="conn-data-simple"></span><h3><span class="section-number">4.4.1. </span>Datos simples<a class="headerlink" href="#datos-simples" title="Link to this heading">#</a></h3>
<p>Por datos simples entendemos los que representan caracteres, enteros, números
reales(flotantes o de precisión fija) o booleanos y tienen, por lo general, un
equivalente propio de Java.</p>
<div class="pst-scrollable-table-container"><table class="tipos-sql table">
<thead>
<tr class="row-odd"><th class="head"><p>Tipo <abbr title="Structured Query Language">SQL</abbr></p></th>
<th class="head"><p>Tipo Java<a class="footnote-reference brackets" href="#id12" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a></p></th>
<th class="head"><p>Método <abbr title="Java DataBase Connectivity">JDBC</abbr> de <a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/PreparedStatement.html">PreparedStatement</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">CHAR(n)</div>
<div class="line">VARCHAR(n)</div>
</div>
</td>
<td><p><a class="extlink-java-lang reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/String.html">String</a></p></td>
<td><p>setString(int idx, String v)</p></td>
</tr>
<tr class="row-odd"><td><div class="line-block">
<div class="line">SMALLINT</div>
<div class="line">INTEGER</div>
<div class="line">BIGINT</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><a class="extlink-java-lang reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/Short.html">Short</a></div>
<div class="line"><a class="extlink-java-lang reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/Integer.html">Integer</a></div>
<div class="line"><a class="extlink-java-lang reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/Long.html">Long</a></div>
</div>
</td>
<td><div class="line-block">
<div class="line">setShort(int idx, short v)</div>
<div class="line">setInt(int idx, int v)</div>
<div class="line">setLong(int idx, long v)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>BOOLEAN</p></td>
<td><p><a class="extlink-java-lang reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/Boolean.html">Boolean</a></p></td>
<td><div class="line-block">
<div class="line">setBoolean(int idx, boolean v)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>NUMERIC/DECIMAL</p></td>
<td><p><a class="extlink-java-lang reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/BigDecimal.html">BigDecimal</a></p></td>
<td><div class="line-block">
<div class="line">setBigDecimal(int idx, BigDecimal</div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">FLOAT</div>
<div class="line">DOUBLE</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><a class="extlink-java-lang reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/Float.html">Float</a></div>
<div class="line"><a class="extlink-java-lang reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/Double.html">Double</a></div>
</div>
</td>
<td><div class="line-block">
<div class="line">setFloat(int idx, float v)</div>
<div class="line">setDouble(int idx, double v)</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>No hay más que sustituir <cite>set</cite> por <cite>get</cite> para obtener los métodos de
<a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/PreparedStatement.html">PreparedStatement</a> necesarios para guardar datos.</p>
</div>
<p>Ejemplos de cómo obtener o escribir datos de este tipo ya se han dejado
escritos en los ejemplos de apartados anteriores. Sólo <a class="extlink-java-math reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/math/BigDecimal.html">BigDecimal</a>
no es un tipo primitivo en Java, pero su uso es trivial:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BigDecimal</span><span class="w"> </span><span class="n">comaFija</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BigDecimal</span><span class="p">(</span><span class="s">&quot;13.456&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p class="rubric">SQLite</p>
<p>Dado que hemos escogido este <abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr> para desarrollar la unidad, nos conviene
centrarnos en sus particularidades. La característica fundamental de <strong class="program">SQLite</strong>
es que tiene <strong>tipado dinámico</strong> y cuál sea el tipo que declaremos al crear la tabla
es irrelevante, porque el sistema gestor aceptará el dato con independencia de
su tipo. Por ejemplo:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persona</span><span class="w"> </span><span class="p">(</span>
<span class="w">   </span><span class="n">nombre</span><span class="w">    </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="p">);</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">Persona</span><span class="w"> </span><span class="k">VALUES</span>
<span class="w">   </span><span class="p">(</span><span class="ss">&quot;Manolo&quot;</span><span class="p">),</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="n">Consecuente</span><span class="w"> </span><span class="n">con</span><span class="w"> </span><span class="n">la</span><span class="w"> </span><span class="n">definición</span><span class="p">:</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">da</span><span class="w"> </span><span class="n">problemas</span><span class="p">.</span>
<span class="w">   </span><span class="p">(</span><span class="mi">4356</span><span class="p">);</span><span class="w">       </span><span class="o">//</span><span class="w"> </span><span class="n">Inconsecuente</span><span class="p">,</span><span class="w"> </span><span class="n">pero</span><span class="w"> </span><span class="n">da</span><span class="w"> </span><span class="n">igual</span><span class="p">:</span><span class="w"> </span><span class="n">el</span><span class="w"> </span><span class="n">dato</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="n">almacena</span><span class="w"> </span><span class="n">como</span><span class="w"> </span><span class="n">entero</span><span class="p">.</span>
</pre></div>
</div>
<p>De hecho, <strong class="program">SQLite</strong> ni siquiera atiende a qué palabra usamos para
definir el tipo y creará la tabla, incluso aunque nos inventemos el nombre del
tipo:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Persona</span><span class="w"> </span><span class="p">(</span>
<span class="w">   </span><span class="n">nombre</span><span class="w">    </span><span class="n">TIPOINVENTADO</span><span class="w">   </span><span class="o">//</span><span class="w"> </span><span class="k">No</span><span class="w"> </span><span class="n">da</span><span class="w"> </span><span class="n">error</span><span class="p">.</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Internamente, <strong class="program">SQLite</strong> sólo dispone de datos de tipo texto, entero (de
diverso tamaño), doble y BLOB; y dependiendo del valor que se suministre usará
un tipo u otro para el dato. Así, <code class="docutils literal notranslate"><span class="pre">CHAR</span></code> y <code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code> se asimilan a texto,
<code class="docutils literal notranslate"><span class="pre">INTEGER</span></code>, <code class="docutils literal notranslate"><span class="pre">BIGINT</span></code>, <code class="docutils literal notranslate"><span class="pre">SMALLINT</span></code> y <code class="docutils literal notranslate"><span class="pre">BOOLEAN</span></code> a enteros, <code class="docutils literal notranslate"><span class="pre">FLOAT</span></code>,
<code class="docutils literal notranslate"><span class="pre">DOBLE</span></code> y <code class="docutils literal notranslate"><span class="pre">NUMERIC</span></code>/<code class="docutils literal notranslate"><span class="pre">DECIMAL</span></code> a dobles (por tanto, se perderá la precisión
de este último tipo).</p>
</section>
<section id="datos-complejos">
<span id="conn-data-complex"></span><h3><span class="section-number">4.4.2. </span>Datos complejos<a class="headerlink" href="#datos-complejos" title="Link to this heading">#</a></h3>
<p>Los datos complejos se caracterizan porque el paquete <code class="docutils literal notranslate"><span class="pre">java.sql</span></code> tiene
definidos tipos específicos que se corresponden con los definidos en el estándar
<abbr title="Structured Query Language">SQL</abbr>.</p>
<div class="pst-scrollable-table-container"><table class="tipos-sql table">
<thead>
<tr class="row-odd"><th class="head"><p>Tipo <abbr title="Structured Query Language">SQL</abbr></p></th>
<th class="head"><p>Tipo Java</p></th>
<th class="head"><p>Método <abbr title="Java DataBase Connectivity">JDBC</abbr> de <a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/PreparedStatement.html">PreparedStatement</a></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><div class="line-block">
<div class="line">DATE</div>
<div class="line">TIME</div>
<div class="line">TIMESTAMP</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/Date.html">java.sql.Date</a></div>
<div class="line"><a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/Time.html">java.sql.Time</a></div>
<div class="line"><a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/Timestamp.html">java.sql.Timestamp</a></div>
</div>
</td>
<td><div class="line-block">
<div class="line">setDate(int idx, java.sql.Date v)</div>
<div class="line">setTime(int idx, java.sql.Time v)</div>
<div class="line">setTimestamp(int idx, java.sql.Timestamp v)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>BLOB</p></td>
<td><div class="line-block">
<div class="line"><a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/Blob.html">java.sql.Blob</a></div>
<div class="line"><a class="extlink-java-io reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/io/InputStream.html">InputStream</a></div>
</div>
</td>
<td><div class="line-block">
<div class="line">setBlob(int idx, java.sql.Blob v)</div>
<div class="line">setBinaryStream(int idx, InputStream v)</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>CLOB</p></td>
<td><div class="line-block">
<div class="line"><a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/Clob.html">java.sql.Clob</a></div>
<div class="line"><a class="extlink-java-io reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/io/Reader.html">Reader</a></div>
</div>
</td>
<td><div class="line-block">
<div class="line">setClob(int idx, java.sql.Clob v)</div>
<div class="line">setCharacterStream(int idx, Reader v)</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>JSON</p></td>
<td><p><a class="extlink-java-lang reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/String.html">String</a></p></td>
<td><p>setString(int idx, String v)</p></td>
</tr>
<tr class="row-even"><td><div class="line-block">
<div class="line">ARRAY</div>
<div class="line">STRUCT</div>
</div>
</td>
<td><div class="line-block">
<div class="line"><a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/Array.html">java.sql.Array</a></div>
<div class="line"><a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/Struct.html">java.sql.Struct</a></div>
</div>
</td>
<td><div class="line-block">
<div class="line">setArray(int idx, java.sql.Array v)</div>
<div class="line">setStruct(int idx, java.sql.Struct v)</div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<section id="fechas-y-tiempos">
<span id="conn-date"></span><h4><span class="section-number">4.4.2.1. </span>Fechas y tiempos<a class="headerlink" href="#fechas-y-tiempos" title="Link to this heading">#</a></h4>
<p>El estándar <abbr title="Structured Query Language">SQL</abbr> define cinco tipos de datos para la expresión de tiempos:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DATE</span></code> que sirve para definir fechas (p.e. '2014-01-08').</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TIME</span></code> que sirve para definir horas con precisión de segundos (p.e.
'08:30:21'), aunque también podría incluirse precisión de hasta el
microsegundo, añadiendo decimales al segundo.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span></code> que combina en un mismo tipo fecha y hora (p.e. '2014-01-08
08:30:21').</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span> <span class="pre">WITH</span> <span class="pre">TIME</span> <span class="pre">ZONE</span></code> que permite almacenar, además, el huso horario
(p.e. '2014-01-08 08:30:21+01:00').</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">INTERVAL</span></code> para almacenar periodos de tiempo (p.e. 'INTERVAL 2 DAYS' o
'INTERVAL 2 DAYS 10 HOURS').</p></li>
</ol>
<p>A través de <abbr title="Java DataBase Connectivity">JDBC</abbr> sólo se soportan directamente los tres primeros tipos y,
además, se requiere saber cómo convertir entre <a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/Date.html">java.sql.Date</a>,
<a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/Time.html">java.sql.Time</a>, <a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/Timestamp.html">java.sql.Timestamp</a> y los tipos con los que frecuentemente
se trabaja en <em>Java</em>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDate</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.time.LocalDateTime</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.Date</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.Time</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.Timestamp</span><span class="p">;</span>

<span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">Date</span><span class="w"> </span><span class="n">udate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">util</span><span class="p">.</span><span class="na">Date</span><span class="p">();</span><span class="w"> </span><span class="c1">// Almacena fecha y hora.</span>

<span class="c1">// Date --&gt; Date</span>
<span class="n">Date</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="n">udate</span><span class="p">.</span><span class="na">getTime</span><span class="p">());</span>

<span class="c1">// Date --&gt; Date</span>
<span class="n">udate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="n">date</span><span class="p">.</span><span class="na">getTime</span><span class="p">());</span>

<span class="c1">// Date --&gt; Time</span>
<span class="n">Time</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Time</span><span class="p">(</span><span class="n">date</span><span class="p">.</span><span class="na">getTime</span><span class="p">());</span>

<span class="c1">// Time --&gt; Date</span>
<span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="na">getTime</span><span class="p">());</span>

<span class="c1">// Date --&gt; Timestamp</span>
<span class="n">Timestamp</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Timestamp</span><span class="p">(</span><span class="n">date</span><span class="p">.</span><span class="na">getTime</span><span class="p">());</span>

<span class="c1">// Timestamp --&gt; Date</span>
<span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">(</span><span class="n">timestamp</span><span class="p">.</span><span class="na">getTime</span><span class="p">());</span>

<span class="n">LocalDate</span><span class="w"> </span><span class="n">localDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDate</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>

<span class="c1">// LocalDate --&gt; Date</span>
<span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Date</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">localDate</span><span class="p">);</span>

<span class="c1">// Date --&gt; LocalDate</span>
<span class="n">localDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">date</span><span class="p">.</span><span class="na">toLocalDate</span><span class="p">();</span>

<span class="n">LocalTime</span><span class="w"> </span><span class="n">localTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalTime</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>

<span class="c1">// LocalTime --&gt; Time</span>
<span class="n">sqltime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">localTime</span><span class="p">);</span>

<span class="c1">// Time --&gt; Localtime</span>
<span class="n">localTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Time</span><span class="p">.</span><span class="na">toLocalTime</span><span class="p">();</span>

<span class="n">LocalDateTime</span><span class="w"> </span><span class="n">localDateTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="p">.</span><span class="na">now</span><span class="p">();</span>

<span class="c1">// LocalDateTime --&gt; Timestamp</span>
<span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Timestamp</span><span class="p">.</span><span class="na">valueOf</span><span class="p">(</span><span class="n">localDateTime</span><span class="p">);</span>

<span class="c1">// Timestamp --&gt; LocalDateTime</span>
<span class="n">localDateTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">timestamp</span><span class="p">.</span><span class="na">toLocalDateTime</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="blob-y-clob">
<h4><span class="section-number">4.4.2.2. </span>BLOB y CLOB<a class="headerlink" href="#blob-y-clob" title="Link to this heading">#</a></h4>
<p>Ambos tipos representan datos de tamaño considerable, <code class="docutils literal notranslate"><span class="pre">BLOB</span></code> un datos binarios
(p.e. una imagen) y <code class="docutils literal notranslate"><span class="pre">CLOB</span></code> un conjunto de caracteres, o sea, un texto grande
que el que se podrían almacenar con <code class="docutils literal notranslate"><span class="pre">VARCHAR</span></code> (cuyo límite depende del
<abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr>). Al margen de esa diferencia, explicado uno, explicado el otro.</p>
<p>Por ejemplo, si tuviéramos un archivo con una foto que quisiéramos guardar en
una base de datos podríamos hacer:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="w"> </span><span class="p">(</span>
<span class="w">   </span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">dbUrl</span><span class="p">);</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">try</span><span class="p">(</span>
<span class="w">      </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">pstmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">preparedStatement</span><span class="p">(</span><span class="s">&quot;INSERT INTO Persona (nombre, avatar) VALUES (?, ?)&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">      </span><span class="n">Path</span><span class="w"> </span><span class="n">archivo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Path</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="s">&quot;ruta&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;al&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;archivo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;jpg&quot;</span><span class="p">);</span>
</span><span class="hll"><span class="w">      </span><span class="k">try</span><span class="p">(</span><span class="n">InputStream</span><span class="w"> </span><span class="n">st</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Files</span><span class="p">.</span><span class="na">newInputStream</span><span class="p">(</span><span class="n">archivo</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span class="w">         </span><span class="n">pstmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Manolito&quot;</span><span class="p">);</span>
<span class="hll"><span class="w">         </span><span class="n">pstmt</span><span class="p">.</span><span class="na">setBinaryStream</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">st</span><span class="p">);</span>
</span><span class="w">         </span><span class="n">pstmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>También podríamos querer guardar un archivo binaro ya cargado en memoria:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">archivo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="mi">221</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">}</span>
</span><span class="hll"><span class="n">Blob</span><span class="w"> </span><span class="n">blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">createBlob</span><span class="p">();</span>
</span><span class="hll"><span class="n">blob</span><span class="p">.</span><span class="na">setBytes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">archivo</span><span class="p">);</span><span class="w"> </span><span class="c1">// Agregamos la secuencia de bytes al principio del Blob.</span>
</span>
<span class="k">try</span><span class="w"> </span><span class="p">(</span>
<span class="w">   </span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DriverManager</span><span class="p">.</span><span class="na">getConnection</span><span class="p">(</span><span class="n">dbUrl</span><span class="p">);</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">try</span><span class="p">(</span>
<span class="w">      </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">pstmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">preparedStatement</span><span class="p">(</span><span class="s">&quot;INSERT INTO Persona (nombre, avatar) VALUES (?, ?)&quot;</span><span class="p">)</span>
<span class="w">   </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">pstmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Manolito&quot;</span><span class="p">);</span>
<span class="hll"><span class="w">      </span><span class="n">pstmt</span><span class="p">.</span><span class="na">setBlob</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">blob</span><span class="p">);</span>
</span><span class="w">      </span><span class="n">pstmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">blob</span><span class="p">.</span><span class="na">free</span><span class="p">();</span><span class="w">  </span><span class="c1">// Vaciamos el blob para liberar la memoria.</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="json">
<h4><span class="section-number">4.4.2.3. </span>JSON<a class="headerlink" href="#json" title="Link to this heading">#</a></h4>
<p>Desde <abbr title="Structured Query Language">SQL</abbr>:2023 el estándar soporta de forma nativa el tipo <abbr title="JavaScript Object Notation">JSON</abbr>. Sin
embargo, <abbr title="Java DataBase Connectivity">JDBC</abbr> aún no tiene soporte alguno para ello, así que el único modo de
tratarlo es a través de <a class="extlink-java-lang reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/String.html">String</a>.</p>
</section>
<section id="array-y-struct">
<h4><span class="section-number">4.4.2.4. </span>ARRAY y STRUCT<a class="headerlink" href="#array-y-struct" title="Link to this heading">#</a></h4>
<p>El tipo de dato <code class="docutils literal notranslate"><span class="pre">ARRAY</span></code> es, simplemente, una secuencia de datos de un mismo
tipo, o sea, lo que entenderíamos como <em>array</em> en cualquier lenguaje de
programación:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">Trabaja</span><span class="w"> </span><span class="p">(</span>
<span class="w">   </span><span class="n">profesor</span><span class="w">        </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">   </span><span class="n">claustro</span><span class="w">        </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">   </span><span class="n">departamento</span><span class="w">    </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">   </span><span class="c1">-- Para poder asignar varios casilleros a un mismo profesor</span>
<span class="hll"><span class="w">   </span><span class="n">casillero</span><span class="w">       </span><span class="nb">INTEGER</span><span class="w"> </span><span class="nb">ARRAY</span><span class="w">   </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span>
<span class="w">   </span><span class="cm">/* Restricciones */</span>
<span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">STRUCT</span></code>, en cambio, es un tipo de dato que permite incluir
como valor de un campo una estructura de datos al modo de las estructuras <em>C</em> o
los mapas de <em>Python</em> o <em>Java</em>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="w"> </span><span class="k">No</span><span class="w"> </span><span class="n">pueden</span><span class="w"> </span><span class="n">definirse</span><span class="w"> </span><span class="n">restricciones</span><span class="w"> </span><span class="n">en</span><span class="w"> </span><span class="n">la</span><span class="w"> </span><span class="n">definición</span><span class="p">,</span><span class="w"> </span><span class="n">así</span><span class="w"> </span><span class="n">que</span><span class="w"> </span><span class="n">estas</span>
<span class="o">//</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">e</span><span class="p">.</span><span class="w"> </span><span class="n">tipo_via</span><span class="w"> </span><span class="n">debería</span><span class="w"> </span><span class="n">incluir</span><span class="w"> </span><span class="n">un</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="n">con</span><span class="w"> </span><span class="n">varios</span><span class="w"> </span><span class="n">valores</span><span class="p">)</span>
<span class="o">//</span><span class="w"> </span><span class="n">debe</span><span class="w"> </span><span class="n">definirse</span><span class="w"> </span><span class="n">en</span><span class="w"> </span><span class="n">la</span><span class="w"> </span><span class="n">tabla</span><span class="w"> </span><span class="n">en</span><span class="w"> </span><span class="n">la</span><span class="w"> </span><span class="n">que</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="n">incluya</span><span class="w"> </span><span class="n">este</span><span class="w"> </span><span class="n">tipo</span><span class="w"> </span><span class="n">struct</span><span class="p">.</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="n">domicilio</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">(</span>
<span class="w">   </span><span class="n">tipo_via</span><span class="w">       </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span>
<span class="w">   </span><span class="n">nombre_via</span><span class="w">     </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">150</span><span class="p">),</span>
<span class="w">   </span><span class="n">numero</span><span class="w">         </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">   </span><span class="n">bloque</span><span class="w">         </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="w">   </span><span class="n">escalera</span><span class="w">       </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="w">   </span><span class="n">piso</span><span class="w">           </span><span class="nb">INTEGER</span><span class="p">,</span>
<span class="w">   </span><span class="n">letra</span><span class="w">          </span><span class="nb">CHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
<p class="rubric">SQLite</p>
<p><strong class="program">SQLite</strong> no soporta de forma nativa los datos complejos (ya explicamos
al tratar los datos simples cómo funcionan en realidad los tipos en él). En
particular:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">DATE</span></code>/<code class="docutils literal notranslate"><span class="pre">TIME</span></code>/<code class="docutils literal notranslate"><span class="pre">TIMESTAMP</span></code></dt><dd><p>Puede almacenarlos como una cadena (“2024-12-12”), un entero(el tiempo <em>UNIX</em>
1733961600) o un flotante (<a class="reference external" href="https://es.wikipedia.org/wiki/Fecha_juliana">fecha juliana</a> usada en Astronomía). Para
darles soporte añade funciones específicas.</p>
<p>En el caso particular de <abbr title="Java DataBase Connectivity">JDBC</abbr>, <code class="docutils literal notranslate"><span class="pre">setDate</span></code> almacenará la fecha como un
entero, lo cual nos es indiferente si leemos los campos con <code class="docutils literal notranslate"><span class="pre">getDate</span></code>, pero
quizás no nos guste tanto, si la lectura la hacemos por otros medios (p.e.
usando directamente el cliente de <strong class="program">SQLite</strong> sin echar mano de funciones
específicas).</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">BLOB</span></code></dt><dd><p>Es el único dato complejo que realmente soporta <strong class="program">SQLite</strong>, así que no
tendremos problemas con él.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CLOB</span></code></dt><dd><p><strong class="program">SQLite</strong> no le da un tratamiento especial y se trata como cualquier
otra cadena, ya que internamente <strong class="program">SQLite</strong> sólo tiene un tipo para
datos que son cadenas. Sin embargo, <code class="docutils literal notranslate"><span class="pre">setClob</span></code> <strong>no está implementado</strong> para
él, por lo que tendremos que usar <code class="docutils literal notranslate"><span class="pre">setString</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">JSON</span></code></dt><dd><p>No tiene soporte nativo sino a través de funciones específicas. En cualquier
caso, <abbr title="Java DataBase Connectivity">JDBC</abbr> tampoco lo tiene con lo que tendrá que usarse <code class="docutils literal notranslate"><span class="pre">setString</span></code>
igual que para el resto de <abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ARRAY</span></code>/<code class="docutils literal notranslate"><span class="pre">STRUCT</span></code></dt><dd><p>No tienen soporte en <strong class="program">SQLite</strong> y, además, los métodos <code class="docutils literal notranslate"><span class="pre">setArray</span></code> y
<code class="docutils literal notranslate"><span class="pre">setStruct</span></code> no están implementados para el <em>driver</em>.</p>
</dd>
</dl>
</section>
</section>
</section>
<section id="transacciones">
<span id="conn-transactions"></span><h2><span class="section-number">4.5. </span>Transacciones<a class="headerlink" href="#transacciones" title="Link to this heading">#</a></h2>
<p>Hasta ahora hemos obviado el concepto de transacción. Una <em class="dfn">transacción</em> es
una operación sobre la base datos, no necesariamente atómica, que debe
completarse o no hacerse en absoluto, es decir, si una <em>transacción</em> se
compone de dos operaciones (sentencias <abbr title="Structured Query Language">SQL</abbr>), ambas operaciones deben
realizarse.</p>
<p>Por ejemplo, en una tienda la venta de un bolígrafo implica dos cosas:</p>
<ul class="simple">
<li><p>Ingresar el importe del bolígrafo.</p></li>
<li><p>Eliminar el bolígrafo del almacén.</p></li>
</ul>
<p>Ambas operaciones son indisolubles y hemos de hacerlas para que se complete la
venta, o no hacerlas en absoluto para que quede la venta pendiente. En cambio,
si se hiciera una y no la otra, la base de datos quedaría en un estado
inconsistente.</p>
<section id="manejo-de-transacciones">
<h3><span class="section-number">4.5.1. </span>Manejo de transacciones<a class="headerlink" href="#manejo-de-transacciones" title="Link to this heading">#</a></h3>
<p>En los ejemplos con que hemos ilustrado los distintos casos, cada sentencia
<abbr title="Structured Query Language">SQL</abbr> constituye una transacción diferente. Si queremos que varias sentencias
pertenezcan a una misma transacción debemos hacer lo siguiente:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">conn</span><span class="p">.</span><span class="na">setAutoCommit</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w">  </span><span class="c1">// Evitamos que cada sentencia implique una transacción</span>
</span>
<span class="k">try</span><span class="p">(</span>
<span class="w">   </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">pstmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="s">&quot;INSERT INTO Departamento (denominacion) VALUES (?)&quot;</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">denominacion</span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Informática&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Inglés&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Tecnología&quot;</span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">pstmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">denominacion</span><span class="p">);</span>
<span class="w">        </span><span class="n">pstmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="hll"><span class="w">    </span><span class="n">conn</span><span class="p">.</span><span class="na">commit</span><span class="p">();</span><span class="w"> </span><span class="c1">// Después de ejecutar todas las sentencias, las confirmamos.</span>
</span><span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">err</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="hll"><span class="w">   </span><span class="n">conn</span><span class="p">.</span><span class="na">rollback</span><span class="p">();</span><span class="w">  </span><span class="c1">// Hubo un problema, no ejecutamos ninguna inserción.</span>
</span><span class="p">}</span>
<span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="hll"><span class="w">   </span><span class="n">conn</span><span class="p">.</span><span class="na">setAutoCommit</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Importante</p>
<p>En el ejemplo, las sentencias son una misma sentencia con
distinto parámetros.  Evidentemente, las transacciones pueden estar
constituidas por cualesquiera sentencias.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Más adelante se propone un mecanismo para gestionar
<a class="reference internal" href="#conn-transaction-manager"><span class="std std-ref">transacciones con un bloque try-with-resources</span></a>.</p>
</div>
</section>
<section id="operaciones-masivas">
<span id="conn-batch"></span><h3><span class="section-number">4.5.2. </span>Operaciones masivas<a class="headerlink" href="#operaciones-masivas" title="Link to this heading">#</a></h3>
<p>En el caso de que tengamos que llevar a cabos muchas operaciones que comparten
la misma sentencia y distintos parámetros (como en el ejemplo anterior
precisamente), el modo más eficiente para llevarlas a cabo es el siguiente:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">conn</span><span class="p">.</span><span class="na">setAutoCommit</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span><span class="w">  </span><span class="c1">// Todas las inserciones forman parte de una transacción</span>

<span class="k">try</span><span class="p">(</span>
<span class="w">   </span><span class="n">PreparedStatement</span><span class="w"> </span><span class="n">pstmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="s">&quot;INSERT INTO Departamento (denominacion) VALUES (?)&quot;</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">denominacion</span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Informática&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Inglés&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Tecnología&quot;</span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">pstmt</span><span class="p">.</span><span class="na">setString</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">denominacion</span><span class="p">);</span>
<span class="hll"><span class="w">        </span><span class="n">pstmt</span><span class="p">.</span><span class="na">addBatch</span><span class="p">();</span><span class="w">  </span><span class="c1">// Añadimos la inserción al procedimiento.</span>
</span><span class="w">    </span><span class="p">}</span>

<span class="hll"><span class="w">    </span><span class="n">pstmt</span><span class="p">.</span><span class="na">executeBatch</span><span class="p">();</span><span class="w"> </span><span class="c1">// Ejecutamos todas las inserciones pendientes.</span>
</span><span class="w">    </span><span class="n">conn</span><span class="p">.</span><span class="na">commit</span><span class="p">();</span><span class="w"> </span><span class="c1">// Grabamos la transacción.</span>
<span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">err</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">   </span><span class="n">conn</span><span class="p">.</span><span class="na">rollback</span><span class="p">();</span><span class="w">  </span><span class="c1">// Hubo un problema, no ejecutamos ninguna inserción.</span>
<span class="p">}</span>
<span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">conn</span><span class="p">.</span><span class="na">setAutoCommit</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="extras">
<span id="conn-extra"></span><h2><span class="section-number">4.6. </span>Extras<a class="headerlink" href="#extras" title="Link to this heading">#</a></h2>
<p>Arrinconamos bajo este epígrafe, algunos aspectos adiciones de los conectores:</p>
<section id="tratamiento-funcional-de-las-consultas">
<h3><span class="section-number">4.6.1. </span>Tratamiento funcional de las consultas<a class="headerlink" href="#tratamiento-funcional-de-las-consultas" title="Link to this heading">#</a></h3>
<p><a class="extlink-java-sql reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.sql/java/sql/ResultSet.html">ResultSet</a> permite ir obteniendo fila a fila los resultados de una consulta.
Sin embargo, no proporciona una interfaz funcional que nos permita utilizar las
<a class="reference internal" href="../98.apendices/01.funcional/10.flujos.html#java-stream-operaciones"><span class="std std-ref">operaciones funcionales habituales</span></a>. Para
paliarlo podemos definir una clase que haga la conversión (véase el <a class="reference download internal" download="" href="../_downloads/d6d0c3e5a9b35fa70f3aab0c2d818f3e/JdbcUtils.java"><code class="xref download docutils literal notranslate"><span class="pre">codigo</span> <span class="pre">fuente</span></code></a>):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">JdbcUtils</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Implementa un iterador a partir de un ResultSet.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ResultSetIterator</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Iterator</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">avanzar</span><span class="p">;</span>
<span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">hasNextElement</span><span class="p">;</span>

<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">ResultSetIterator</span><span class="p">(</span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rs</span><span class="p">;</span>
<span class="w">            </span><span class="n">avanzar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="nd">@Override</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">hasNext</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">avanzar</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">hasNextElement</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">();</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">err</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">avanzar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">hasNextElement</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>


<span class="w">        </span><span class="nd">@Override</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">ResultSet</span><span class="w"> </span><span class="nf">next</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">avanzar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">rs</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span>
<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Genera un flujo con las filas generadas en un ResultSet.</span>
<span class="cm">     * @param rs Los resutados de una consulta.</span>
<span class="cm">     * @return Un flujo en el que cada elemento es el siguiente estado del ResultSet proporcionado.</span>
<span class="cm">     * @throws SQLException Cuando se produce un error al realizar la consulta.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">resultSetToStream</span><span class="p">(</span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">StreamSupport</span><span class="p">.</span><span class="na">stream</span><span class="p">(</span><span class="n">Spliterators</span><span class="p">.</span><span class="na">spliteratorUnknownSize</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ResultSetIterator</span><span class="p">(</span><span class="n">rs</span><span class="p">),</span><span class="w"> </span><span class="n">Spliterator</span><span class="p">.</span><span class="na">ORDERED</span><span class="p">),</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="cm">/**</span>
<span class="cm">     * Genera un flujo de objetos derivados del resultado de una consulta.</span>
<span class="cm">     * @param &lt;T&gt; La clase del objeto.</span>
<span class="cm">     * @param rs  El objeto que representa los resultado de la consulta.</span>
<span class="cm">     * @param mapper La función que permite transformar la fila en un objeto.</span>
<span class="cm">     * @return El flujo de objetos.</span>
<span class="cm">     * @throws SQLExceptionCuando Cuando se produce un error al realizar la consulta.</span>
<span class="cm">     */</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">resultSetToStream</span><span class="p">(</span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="p">,</span><span class="w"> </span><span class="n">Function</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mapper</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">resultSetToStream</span><span class="p">(</span><span class="n">rs</span><span class="p">).</span><span class="na">map</span><span class="p">(</span><span class="n">mapper</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Si incluimos este archivo en nuestro proyecto podremos hacer consultas de este
modo:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ResultSet</span><span class="w"> </span><span class="n">rs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stmt</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span><span class="s">&quot;SELECT * FROM Departamento&quot;</span><span class="p">);</span>

<span class="hll"><span class="n">Stream</span><span class="o">&lt;</span><span class="n">Departamento</span><span class="o">&gt;</span><span class="w"> </span><span class="n">departamentos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JdbcUtils</span><span class="p">.</span><span class="na">resultSetToStream</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span><span class="w"> </span><span class="n">fila</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span class="w">   </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fila</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="s">&quot;id_departamento&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="n">String</span><span class="w"> </span><span class="n">denominacion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fila</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;denominacion&quot;</span><span class="p">);</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Departamento</span><span class="p">().</span><span class="na">cargarDatos</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">denominacion</span><span class="p">);</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">err</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">});</span>

<span class="c1">//Tratamos el flujo como estimemos más oportuno.</span>
<span class="k">for</span><span class="p">(</span><span class="n">Departamento</span><span class="w"> </span><span class="n">d</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Departamento</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">departamentos</span><span class="p">::</span><span class="n">iterator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;ID: %d -- Denominación: %s&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="na">getId</span><span class="p">(),</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="na">getDenominacion</span><span class="p">()));</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Truco</p>
<p>El método <code class="docutils literal notranslate"><span class="pre">resultSetToStreamp</span></code> permite no definir la función que
transforma la fila (el propio <code class="docutils literal notranslate"><span class="pre">ResultSet</span></code>) en un objeto. En ese caso, se
obtendrá con cada elemento del flujo la propia fila:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">ResultSet</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">JdbcUtils</span><span class="p">.</span><span class="na">resultSetToStream</span><span class="p">(</span><span class="n">rs</span><span class="p">);</span>
</pre></div>
</div>
</div>
</section>
<section id="pool-de-conexiones">
<h3><span class="section-number">4.6.2. </span><em>Pool</em> de conexiones<a class="headerlink" href="#pool-de-conexiones" title="Link to this heading">#</a></h3>
<div class="admonition-todo admonition" id="id6">
<p class="admonition-title">Por hacer</p>
<p>Pool de conexiones…</p>
</div>
</section>
<section id="metadatos">
<h3><span class="section-number">4.6.3. </span>Metadatos<a class="headerlink" href="#metadatos" title="Link to this heading">#</a></h3>
<div class="admonition-todo admonition" id="id7">
<p class="admonition-title">Por hacer</p>
<p>DatabaseMetaData y ResultSetMetaData.</p>
</div>
</section>
<section id="gestor-de-transacciones">
<span id="conn-transaction-manager"></span><h3><span class="section-number">4.6.4. </span>Gestor de transacciones<a class="headerlink" href="#gestor-de-transacciones" title="Link to this heading">#</a></h3>
<p>Para facilitar la forma en que se gestionan las <a class="reference internal" href="#conn-transactions"><span class="std std-ref">transacciones ya
estudiadas</span></a> podemos crear una clase que explote las
posibilidades del bloque <a class="reference external" href="https://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html">try-with-resources</a>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nn">edu.acceso.ej4_1.bd</span><span class="p">;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.Connection</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">java.sql.SQLException</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">TransactionManager</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">AutoCloseable</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">committed</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">TransactionManager</span><span class="p">(</span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">setConn</span><span class="p">(</span><span class="n">conn</span><span class="p">);</span>
<span class="w">        </span><span class="n">conn</span><span class="p">.</span><span class="na">setAutoCommit</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Connection</span><span class="w"> </span><span class="nf">getConn</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">conn</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setConn</span><span class="p">(</span><span class="n">Connection</span><span class="w"> </span><span class="n">conn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">conn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">commit</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">conn</span><span class="p">.</span><span class="na">commit</span><span class="p">();</span>
<span class="w">        </span><span class="n">committed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">close</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">SQLException</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">committed</span><span class="p">)</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">rollback</span><span class="p">();</span>
<span class="w">        </span><span class="n">conn</span><span class="p">.</span><span class="na">setAutoCommit</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>La clase podría usarse del siguiente modo:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Se supone que conn es una conexión ya abierta.</span>
<span class="k">try</span><span class="w"> </span><span class="p">(</span><span class="n">TransaccionManager</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TransactionManager</span><span class="p">(</span><span class="n">conn</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>

<span class="w">   </span><span class="c1">// Ejecutamos todas las sentencias que constituyen esta transacción</span>
<span class="w">   </span><span class="c1">// ...</span>

<span class="w">   </span><span class="n">tm</span><span class="p">.</span><span class="na">commit</span><span class="p">();</span><span class="w"> </span><span class="c1">// Confirmamos en la base de datos.</span>
<span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="c1">// No hay que hacer rollback, ya que se encarga el close().</span>
<span class="w">   </span><span class="n">err</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Consejo</p>
<p>Podemos incluir esta clase como una clase estática dentro de
<code class="docutils literal notranslate"><span class="pre">JdbcUtils</span></code> para tener todos estos añadidos juntos.</p>
</div>
</section>
<section id="cargar-esquema-desde-archivo">
<h3><span class="section-number">4.6.5. </span>Cargar esquema desde archivo<a class="headerlink" href="#cargar-esquema-desde-archivo" title="Link to this heading">#</a></h3>
<p>Es muy común que la primera vez que se ejecuta la aplicación, ésta cree la base
de datos y defina el esquema y los datos iniciales necesarios. Lo cómodo es que
las sentencias necesarias se encuentren en un guión <abbr title="Structured Query Language">SQL</abbr> y el programa las lea
de él, en vez de encontrarse incrustadas en el código.</p>
<p>Sin embargo, <abbr title="Java DataBase Connectivity">JDBC</abbr> no tiene definido un método que nos permita ejecutar un
guión <abbr title="Structured Query Language">SQL</abbr> completo, así que la única forma de poner ejecutar sus sentencias,
es descomponerlas primero. Para ello podemos optar por dos estrategias:</p>
<ul>
<li><p><cite>JSQLParser
&lt;https://mvnrepository.com/artifact/com.github.jsqlparser/jsqlparser&gt;</cite> que es
capaz de procesar el código <abbr title="Structured Query Language">SQL</abbr> y, por tanto, reconocer los elementos de que
se compone.</p></li>
<li><p>Si el guión no es complejo y seguimos algunas premisas:</p>
<ol class="loweralpha simple">
<li><p>Los “;” que completan sentencias deben encontrarse a final de línea.</p></li>
<li><p>No pueden usarse las palabras <code class="docutils literal notranslate"><span class="pre">begin</span></code> o <code class="docutils literal notranslate"><span class="pre">end</span></code> en comentarios, nombres,
valores, etc.</p></li>
<li><p>No pueden usarse bloques <code class="docutils literal notranslate"><span class="pre">IF</span></code> en aquellos <abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr> que los implementen
(pero sí usarse el estándar <code class="docutils literal notranslate"><span class="pre">CASE</span></code>).</p></li>
</ol>
<p>podemos escribir una solución artesanal, que es la que proponemos.</p>
</li>
</ul>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="cm">/**</span>
<span class="cm">  * Descompone un guión SQL en las sentencias de que se compone.</span>
<span class="cm">  * @param st Entrada de la que se lee el guión</span>
<span class="cm">  * @return  Una lista con las sentencias separadadas.</span>
<span class="cm">  * @throws IOException</span>
<span class="cm">  */</span>
<span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">splitSQL</span><span class="p">(</span><span class="n">InputStream</span><span class="w"> </span><span class="n">st</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="n">Pattern</span><span class="w"> </span><span class="n">beginPattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pattern</span><span class="p">.</span><span class="na">compile</span><span class="p">(</span><span class="s">&quot;\\b(BEGIN|CASE)\\b&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Pattern</span><span class="p">.</span><span class="na">CASE_INSENSITIVE</span><span class="p">);</span>
<span class="w">     </span><span class="n">Pattern</span><span class="w"> </span><span class="n">endPattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pattern</span><span class="p">.</span><span class="na">compile</span><span class="p">(</span><span class="s">&quot;\\bEND\\b&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Pattern</span><span class="p">.</span><span class="na">CASE_INSENSITIVE</span><span class="p">);</span>

<span class="w">     </span><span class="k">try</span><span class="w"> </span><span class="p">(</span>
<span class="w">         </span><span class="n">InputStreamReader</span><span class="w"> </span><span class="n">sr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">InputStreamReader</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="w"> </span><span class="n">StandardCharsets</span><span class="p">.</span><span class="na">UTF_8</span><span class="p">);</span>
<span class="w">         </span><span class="n">BufferedReader</span><span class="w"> </span><span class="n">br</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BufferedReader</span><span class="p">(</span><span class="n">sr</span><span class="p">);</span>
<span class="w">     </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sentencias</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
<span class="w">         </span><span class="n">String</span><span class="w"> </span><span class="n">linea</span><span class="p">;</span>
<span class="w">         </span><span class="n">String</span><span class="w"> </span><span class="n">sentencia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">         </span><span class="kt">int</span><span class="w"> </span><span class="n">contador</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">         </span><span class="k">while</span><span class="p">((</span><span class="n">linea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">br</span><span class="p">.</span><span class="na">readLine</span><span class="p">())</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">             </span><span class="n">linea</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">linea</span><span class="p">.</span><span class="na">trim</span><span class="p">();</span>
<span class="w">             </span><span class="k">if</span><span class="p">(</span><span class="n">linea</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>

<span class="w">             </span><span class="n">Matcher</span><span class="w"> </span><span class="n">beginMatcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beginPattern</span><span class="p">.</span><span class="na">matcher</span><span class="p">(</span><span class="n">linea</span><span class="p">);</span>
<span class="w">             </span><span class="n">Matcher</span><span class="w"> </span><span class="n">endMatcher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">endPattern</span><span class="p">.</span><span class="na">matcher</span><span class="p">(</span><span class="n">linea</span><span class="p">);</span>

<span class="w">             </span><span class="k">while</span><span class="p">(</span><span class="n">beginMatcher</span><span class="p">.</span><span class="na">find</span><span class="p">())</span><span class="w"> </span><span class="n">contador</span><span class="o">++</span><span class="p">;</span>
<span class="w">             </span><span class="k">while</span><span class="p">(</span><span class="n">endMatcher</span><span class="p">.</span><span class="na">find</span><span class="p">())</span><span class="w"> </span><span class="n">contador</span><span class="o">--</span><span class="p">;</span>

<span class="w">             </span><span class="n">sentencia</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&quot;\n&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">linea</span><span class="p">;</span>

<span class="w">             </span><span class="k">if</span><span class="p">(</span><span class="n">contador</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">linea</span><span class="p">.</span><span class="na">endsWith</span><span class="p">(</span><span class="s">&quot;;&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                 </span><span class="n">sentencias</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">sentencia</span><span class="p">);</span>
<span class="w">                 </span><span class="n">sentencia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<span class="w">             </span><span class="p">}</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">         </span><span class="k">return</span><span class="w"> </span><span class="n">sentencias</span><span class="p">;</span>
<span class="w">     </span><span class="p">}</span>
<span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Consejo</p>
<p>Podemos incluir el método dentro de <code class="docutils literal notranslate"><span class="pre">JdbcUtils</span></code>.</p>
</div>
<p>¿Cómo podemos usar este método? Por ejemplo, así:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">tablaExistente</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Profesor&quot;</span><span class="p">;</span>
<span class="kd">final</span><span class="w"> </span><span class="n">Path</span><span class="w"> </span><span class="n">guion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Path</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="na">getProperty</span><span class="p">(</span><span class="s">&quot;user.dir&quot;</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;loquesea.sql&quot;</span><span class="p">);</span>

<span class="c1">// Ya hay una conexión &quot;conn&quot; abierta.</span>
<span class="k">try</span><span class="p">(</span><span class="n">Statement</span><span class="w"> </span><span class="n">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conn</span><span class="p">.</span><span class="na">createStatement</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">stmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">(</span><span class="s">&quot;SELECT 1 FROM &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tablaExistente</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Si la tabla no existe, no hay esquema aún.</span>
<span class="w">   </span><span class="k">try</span><span class="w"> </span><span class="p">(</span>
<span class="w">      </span><span class="n">InputStream</span><span class="w"> </span><span class="n">st</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Files</span><span class="p">.</span><span class="na">newInputStream</span><span class="p">(</span><span class="n">guion</span><span class="p">);</span>
<span class="w">      </span><span class="n">TransactionManager</span><span class="w"> </span><span class="n">tm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TransactionManager</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
<span class="w">   </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sentencias</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">splitSQL</span><span class="p">(</span><span class="n">st</span><span class="p">);</span>
<span class="w">      </span><span class="k">for</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">sentencia</span><span class="p">:</span><span class="w"> </span><span class="n">sentencias</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="n">stmt</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">(</span><span class="n">sentencia</span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">      </span><span class="n">tm</span><span class="p">.</span><span class="na">commit</span><span class="p">();</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">catch</span><span class="p">(</span><span class="n">SQLException</span><span class="w"> </span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">err</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span><span class="w"> </span><span class="c1">// O como se decida tratar el error.</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p class="rubric">Notas al pie</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id8" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>En puridad, los profesores desempeñan puestos que se adscriben a
departamentos y a cada departamento pueden estar adscritos uno o varios
puestos, pero obviaremos esto para simplificar y nos limitaremos a afirmar
que trabajan para departamentos.</p>
</aside>
<aside class="footnote brackets" id="id9" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Según el estandar un nombre que no se encierra entre comillas dobles, se
sobreentiende escrito todo en mayúsculas. En particular, <strong class="program">SQLite</strong> se
salta el estándar en este aspecto y no hace esa distinción, incluso aunque
los nombres si se hayan entrecomillado. Otra razón que avala el que no
entrecomillemos es que <strong class="program">MariaDB</strong>/<strong class="program">MySQL</strong> exige que
cambiemos la configuración predeterminada para soportar el entrecomillado con
comillas dobles, ya que este <abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr> entrecomilla con el acento grave.</p>
</aside>
<aside class="footnote brackets" id="id10" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>Se han supuesto (excepto para <strong class="program">SQLite</strong> obviamente) conexiones
<abbr title="Transmission Control Protocol">TCP</abbr>/<abbr title="Internet Protocol">IP</abbr>. Sin embargo, en sistemas <em>UNIX</em> el motor podría permitir
conexiones a un <em>socket</em> local. Por ejemplo, una <abbr title="Uniform Resource Locator">URL</abbr> a socket local para
MariaDB podría ser
<code class="docutils literal notranslate"><span class="pre">jdbc:mariadb:///mibase?socket=/var/run/mysqld/mysqld.sock</span></code> o
algo parecido.</p>
</aside>
<aside class="footnote brackets" id="id11" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<p>Aunque haremos una excepción aclarando cómo están definidas las claves
primarias en las tablas <code class="docutils literal notranslate"><span class="pre">Claustro</span></code>, <code class="docutils literal notranslate"><span class="pre">Departamento</span></code> y <code class="docutils literal notranslate"><span class="pre">Profesor</span></code>.
Nuestra intención es que sus identificadores se generen automáticamente sin
necesidad de que especifiquemos un valor. Eso se hace en <a class="reference external" href="https://sqlite.org/">SQLite</a> con
<em>AUTOINCREMENT</em>, pero en otros motores se expresa de otro modo, ya que no
forma parte del estándar. Desde <abbr title="Structured Query Language">SQL</abbr>:2003, existe un modo de expresarlo:
<code class="code docutils literal notranslate"><span class="pre">GENERATED</span> <span class="pre">[BY</span> <span class="pre">DEFAULT|ALWAYS]</span> <span class="pre">AS</span> <span class="pre">IDENTITY</span></code>. Sin embargo, <a class="reference external" href="https://sqlite.org/">SQLite</a> no lo
soporta y por eso lo hemos dejado comentado. En cambio, tiene un comportamento
curioso: cuando se usa <code class="docutils literal notranslate"><span class="pre">INTEGER</span></code> para definir la clave primaria asume el
comportamento de <code class="code docutils literal notranslate"><span class="pre">GENERATED</span> <span class="pre">BY</span> <span class="pre">DEFAULT</span> <span class="pre">AS</span> <span class="pre">IDENTITY</span></code> y cuando se usa
<code class="docutils literal notranslate"><span class="pre">INT</span></code> la clave no se genera y hay que especificarla siempre explícitamente
(o sea, el comportamiento que esperaríamos al no haber incluido ninguna
fórmula adicional como <code class="code docutils literal notranslate"><span class="pre">AUTOINCREMENT</span></code> o <code class="code docutils literal notranslate"><span class="pre">GENERATED</span> <span class="pre">BY...</span></code>).</p>
</aside>
<aside class="footnote brackets" id="id12" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">5</a><span class="fn-bracket">]</span></span>
<p>Se han referido clases, pero también equivalen a tipos primitivos (<code class="docutils literal notranslate"><span class="pre">short</span></code> en vez de <a class="extlink-java-lang reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/Short.html">Short</a>.</p>
</aside>
</aside>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../03.xml/03.basex.html"
       title="página anterior">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">anterior</p>
        <p class="prev-next-title"><span class="section-number">3.3. </span>BaseX</p>
      </div>
    </a>
    <a class="right-next"
       href="../98.apendices/index.html"
       title="siguiente página">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">siguiente</p>
        <p class="prev-next-title">Apéndices</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenido
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aperitivo">4.1. Aperitivo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conexion">4.2. Conexión</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ejecucion-de-sentencias">4.3. Ejecución de sentencias</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simples">4.3.1. Simples</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parametrizadas">4.3.2. Parametrizadas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#datos">4.4. Datos</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#datos-simples">4.4.1. Datos simples</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#datos-complejos">4.4.2. Datos complejos</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fechas-y-tiempos">4.4.2.1. Fechas y tiempos</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#blob-y-clob">4.4.2.2. BLOB y CLOB</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#json">4.4.2.3. JSON</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#array-y-struct">4.4.2.4. ARRAY y STRUCT</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transacciones">4.5. Transacciones</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manejo-de-transacciones">4.5.1. Manejo de transacciones</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#operaciones-masivas">4.5.2. Operaciones masivas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extras">4.6. Extras</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tratamiento-funcional-de-las-consultas">4.6.1. Tratamiento funcional de las consultas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pool-de-conexiones">4.6.2. <em>Pool</em> de conexiones</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metadatos">4.6.3. Metadatos</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gestor-de-transacciones">4.6.4. Gestor de transacciones</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cargar-esquema-desde-archivo">4.6.5. Cargar esquema desde archivo</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Por José Miguel Sánchez Alés
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright CC BY 4.0, 2024-2024, José Miguel Sánchez Alés.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>