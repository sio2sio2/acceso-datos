


<!DOCTYPE html>


<html lang="es" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5.6.2.2. Criteria API &#8212; documentación de Acceso a datos - rolling</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" href="../../../_static/general.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/particular.css" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=461dccb6"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=677778c1"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../../../_static/translations.js?v=f85f4cfb"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '05.orm/10.crud/02.avanzadas/02.criteria';</script>
    <link rel="index" title="Índice" href="../../../genindex.html" />
    <link rel="search" title="Búsqueda" href="../../../search.html" />
    <link rel="next" title="5.6.2.3. SQL nativo" href="03.nativo.html" />
    <link rel="prev" title="5.6.2.1. JPQL" href="01.hql.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="es"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Saltar al contenido principal</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Volver arriba</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Advertencia de versión"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.jpg" class="logo__image only-light" alt="documentación de Acceso a datos - rolling - Home"/>
    <script>document.write(`<img src="../../../_static/logo.jpg" class="logo__image only-dark" alt="documentación de Acceso a datos - rolling - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Búsqueda" aria-label="Búsqueda" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Búsqueda</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../01.archivos/index.html">1. Tratamiento de archivos</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../01.archivos/01.gestion.html">1.1. Gestión de archivos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../01.archivos/02.manipulacion.html">1.2. Consulta y manipulación de contenidos</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../02.formatos/index.html">2. Formatos de información</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../02.formatos/01.csv.html">2.1. <abbr title="Comma-Separated Values">CSV</abbr></a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../02.formatos/02.json.html">2.2. <abbr title="JavaScript Object Notation">JSON</abbr></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../02.formatos/02.json/01.gson.html">2.2.1. GSON</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../02.formatos/02.json/02.jackson.html">2.2.2. Jackson</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../../02.formatos/03.yaml.html">2.3. <abbr title="YAML Ain't Markup Language">YAML</abbr></a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../03.xml/index.html">3. <abbr title="eXtensible Markup Language">XML</abbr></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../03.xml/01.jaxp.html">3.1. <abbr title="Java API for XML Processing">JAXP</abbr></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../03.xml/02.jackson.html">3.2. Jackson</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../03.xml/03.basex.html">3.3. BaseX</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../04.conector/index.html">4. Conectores</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../04.conector/01.basico.html">4.1. Operaciones básicas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../04.conector/02.datos.html">4.2. Datos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../04.conector/03.transacciones.html">4.3. Transacciones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../04.conector/04.pool.html">4.4. <em>Pool</em> de conexiones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../04.conector/10.extras.html">4.5. Extras</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../04.conector/15.dao.html">4.6. Programación con conectores</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../../index.html">5. Herramientas <abbr title="Object-Relational Mapping">ORM</abbr></a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../01.conf.html">5.1. Configuración</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02.basico.html">5.2. Operativa básica</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../03.conexion.html">5.3. Conexión</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../04.mapeo.html">5.4. Mapeo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../08.transaction.html">5.5. Transacciones</a></li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="../../10.crud.html">5.6. Operaciones <abbr title="Create, Read, Update, Delete">CRUD</abbr></a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../01.simples.html">5.6.1. Simples</a></li>
<li class="toctree-l3 current active has-children"><a class="reference internal" href="../02.avanzadas.html">5.6.2. Avanzadas</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="01.hql.html">5.6.2.1. <abbr title="Java Persistence Query Language">JPQL</abbr></a></li>
<li class="toctree-l4 current active"><a class="current reference internal" href="#">5.6.2.2. Criteria API</a></li>
<li class="toctree-l4"><a class="reference internal" href="03.nativo.html">5.6.2.3. <abbr title="Structured Query Language">SQL</abbr> nativo</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../15.extra.html">5.7. Otros aspectos</a></li>
</ul>
</details></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../99.ejercicios/index.html">Ejercicios</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../99.ejercicios/01.achivos.html">1. Archivos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../99.ejercicios/02.formatos.html">2. Formatos de información</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../99.ejercicios/03.xml.html">3. Formato <abbr title="eXtensible Markup Language">XML</abbr></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../99.ejercicios/04.conectores.html">4. <abbr title="Java DataBase Connectivity">JDBC</abbr></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../99.ejercicios/05.orm.html">5. <abbr title="Java Persistent API">JPA</abbr></a></li>
</ul>
</details></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../98.apendices/index.html">Apéndices</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../98.apendices/01.funcional.html">1. Java funcional</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../98.apendices/01.funcional/01.function.html">1.1. Interfaces funcionales</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../98.apendices/01.funcional/05.collection.html">1.2. Colecciones</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../98.apendices/01.funcional/10.flujos.html">1.3. Flujos</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../../98.apendices/10.logging.html">2. Sistema de registros</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../98.apendices/99.ide.html">3. Entorno de desarrollo</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Descarga esta pagina">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/05.orm/10.crud/02.avanzadas/02.criteria.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Descargar archivo fuente"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Imprimir en PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Modo de pantalla completa"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="claro/oscuro" aria-label="claro/oscuro" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Búsqueda" aria-label="Búsqueda" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Criteria API</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenido </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consulta-basica">5.6.2.2.1. Consulta básica</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metamodel">5.6.2.2.2. Metamodel</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#condiciones">5.6.2.2.3. Condiciones</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ordenacion">5.6.2.2.4. Ordenación</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#agrupacion">5.6.2.2.5. Agrupación</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#joins">5.6.2.2.6. Joins</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#actualizacion-y-borrado">5.6.2.2.7. Actualización y borrado</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="criteria-api">
<span id="orm-criteria"></span><h1><span class="section-number">5.6.2.2. </span>Criteria API<a class="headerlink" href="#criteria-api" title="Link to this heading">#</a></h1>
<p><em>Criteria API</em> es un mecanismo alternativo a <abbr title="Java Persistence Query Language">JPQL</abbr> para escribir consultas, que
es más verborreico, pero en compensación facilita la construcción dinámica de
las consultas en tiempo de ejecución, ya que no se basa en una cadena, sino en
la aplicación de métodos a objetos. Se inspiró en <em>Hibernate Criteria</em>.</p>
<p>Lo primero antes de construir la consulta es crear un objeto <a class="extlink-hibernate-api reference external" href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/query/criteria/HibernateCriteriaBuilder.html">CriteriaBuilder</a> a
partir del objeto <a class="extlink-jakarta-persistence reference external" href="https://jakarta.ee/specifications/persistence/3.2/apidocs/jakarta.persistence/jakarta/persistence/EntityManager">EntityManager</a>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">CriteriaBuilder</span><span class="w"> </span><span class="n">cb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">em</span><span class="p">.</span><span class="na">getCriteriaBuilder</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Truco</p>
<p>Es mejor crear un único objeto <code class="docutils literal notranslate"><span class="pre">CriterioBuilder</span></code> para construir todas
las consultas.</p>
</div>
<p>A partir de ahora debemos definir qué es lo que se querrá obtener (recordemos
que estamos haciendo un <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>) y sobre qué tabla/entidad se quiere hacer la
consulta. Por ejemplo:</p>
<section id="consulta-basica">
<h2><span class="section-number">5.6.2.2.1. </span>Consulta básica<a class="headerlink" href="#consulta-basica" title="Link to this heading">#</a></h2>
<div class="highlight-java notranslate" id="orm-criteria-select-all"><div class="highlight"><pre><span></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"> </span><span class="c1">// Obtendremos estudiantes.</span>
<span class="n">Root</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"> </span><span class="c1">// Consultamos la entidad Estudiante</span>
<span class="n">criteria</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">root</span><span class="p">);</span><span class="w"> </span><span class="c1">// SELECT e.* FROM Estudiante e;</span>

<span class="n">TypedQuery</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">estudiantes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">em</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">criteria</span><span class="p">);</span>
</pre></div>
</div>
<p>Obsérvese que hacemos la consulta al equivalente <abbr title="Structured Query Language">SQL</abbr>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Estudiante</span><span class="w"> </span><span class="n">e</span><span class="p">;</span>
</pre></div>
</div>
<p>Que obtengamos estudiantes (<code class="code docutils literal notranslate"><span class="pre">e.*</span></code>) es consecuencia de
<code class="code docutils literal notranslate"><span class="pre">cb.createQuery(Estudiante.class)</span></code> y de que hemos aplicado el método
<code class="docutils literal notranslate"><span class="pre">.select</span></code> a <code class="docutils literal notranslate"><span class="pre">root</span></code> sin más. Que la consulta se haya hecho sobre Estudiante
es consecuencia de <code class="code docutils literal notranslate"><span class="pre">criteria.from(Estudiante.class)</span></code>.</p>
<p>Si quisiéramos obtener un campo:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"> </span><span class="c1">// Obtendremos cadenas</span>
</span><span class="n">Root</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"> </span><span class="c1">// Consultamos la entidad Estudiante</span>
<span class="hll"><span class="n">criteria</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;nombre&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// SELECT e.nombre FROM Estudiante e;</span>
</span>
<span class="n">TypedQuery</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">em</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">criteria</span><span class="p">);</span>
</pre></div>
</div>
<p>Y si varios:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">[]&gt;</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Object</span><span class="o">[]</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span class="n">Root</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"> </span><span class="c1">// Consultamos la entidad Estudiante</span>
<span class="hll"><span class="n">criteria</span><span class="p">.</span><span class="na">multiselect</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;nombre&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;centro&quot;</span><span class="p">));</span><span class="w"> </span><span class="c1">// SELECT e.nombre, e.centro FROM Estudiante e;</span>
</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">[]&gt;</span><span class="w"> </span><span class="n">campos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">em</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">criteria</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Truco</p>
<p>En este último caso, puede usarse también <a class="reference internal" href="01.hql.html#orm-tuple"><span class="std std-ref">Tuple como en JPQL</span></a>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="hll"><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Tuple</span><span class="o">&gt;</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Tuple</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"> </span><span class="c1">// o cb.createTupleQuery();</span>
</span><span class="n">Root</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="hll"><span class="n">criteria</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">tuple</span><span class="p">(</span>
</span><span class="hll"><span class="w">   </span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;nombre&quot;</span><span class="p">).</span><span class="na">alias</span><span class="p">(</span><span class="s">&quot;nombre&quot;</span><span class="p">),</span>
</span><span class="hll"><span class="w">   </span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;centro&quot;</span><span class="p">).</span><span class="na">alias</span><span class="p">(</span><span class="s">&quot;centro&quot;</span><span class="p">)</span>
</span><span class="hll"><span class="p">));</span>
</span>
<span class="n">TypedQuery</span><span class="o">&lt;</span><span class="n">Tuple</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">em</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Prudencia</p>
<p>No es una buena práctica referir los atributos de las clases con
una cadena (<code class="code docutils literal notranslate"><span class="pre">root.get(&quot;nombre&quot;)</span></code>), ya que los errores de digitalización no
pueden detectarse en tiempo de compilación. Por ese motivo, es bastante
recomendable generar el <em>Metamodel</em>, que nos permite escribir:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="s">&quot;nombre&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>como:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">nombre</span><span class="p">);</span>
</pre></div>
</div>
<p>donde <code class="docutils literal notranslate"><span class="pre">Estudiante_</span></code> es una clase generada por el compilador.</p>
</div>
</section>
<section id="metamodel">
<span id="orm-jra-metamodel"></span><h2><span class="section-number">5.6.2.2.2. </span>Metamodel<a class="headerlink" href="#metamodel" title="Link to this heading">#</a></h2>
<p>Para la habilitar la creación del <em>metamodelo</em>, debemos añadir como dependencia
<a class="reference external" href="https://mvnrepository.com/artifact/org.hibernate.orm/hibernate-processor">hibernate-processor</a>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>org.hibernate.orm<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>hibernate-processor<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>7.0.0.Beta4<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
<p>Obsérvese su ámbito, ya que necesitamos la librería para el desarrollo, no para
la ejecución de la aplicación.</p>
<p>Además, debemos añadir una sección <cite>&lt;build&gt;</cite> a <code class="file docutils literal notranslate"><span class="pre">pom.xml</span></code>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;build&gt;</span>
<span class="w">   </span><span class="nt">&lt;plugins&gt;</span>
<span class="w">       </span><span class="nt">&lt;plugin&gt;</span>
<span class="w">           </span><span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
<span class="w">           </span><span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">           </span><span class="nt">&lt;version&gt;</span>3.14.0<span class="nt">&lt;/version&gt;</span>
<span class="w">           </span><span class="nt">&lt;configuration&gt;</span>
<span class="w">               </span><span class="nt">&lt;release&gt;</span>21<span class="nt">&lt;/release&gt;</span><span class="w"> </span><span class="cm">&lt;!-- Versión de JDK --&gt;</span>
<span class="w">               </span><span class="nt">&lt;annotationProcessorPaths&gt;</span>
<span class="w">                   </span><span class="nt">&lt;path&gt;</span>
<span class="w">                       </span><span class="nt">&lt;groupId&gt;</span>org.hibernate.orm<span class="nt">&lt;/groupId&gt;</span>
<span class="w">                       </span><span class="nt">&lt;artifactId&gt;</span>hibernate-processor<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">                       </span><span class="nt">&lt;version&gt;</span>7.0.0.Beta4<span class="nt">&lt;/version&gt;</span>
<span class="w">                   </span><span class="nt">&lt;/path&gt;</span>
<span class="w">               </span><span class="nt">&lt;/annotationProcessorPaths&gt;</span>
<span class="w">           </span><span class="nt">&lt;/configuration&gt;</span>
<span class="w">       </span><span class="nt">&lt;/plugin&gt;</span>
<span class="w">   </span><span class="nt">&lt;/plugins&gt;</span>
<span class="nt">&lt;/build&gt;</span>
</pre></div>
</div>
<p>Con esto, deberíamos tener disponibles en el proyecto las metaclases
correspondientes a nuestro modelo (<code class="docutils literal notranslate"><span class="pre">Centro_</span></code> y <code class="docutils literal notranslate"><span class="pre">Estudiante_</span></code> en el ejemplo).</p>
<p>Ahora podríamos reescribir el ejemplo anterior así:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Tuple</span><span class="o">&gt;</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Tuple</span><span class="p">.</span><span class="na">class</span><span class="p">);</span><span class="w"> </span><span class="c1">// o</span>
<span class="n">cb</span><span class="p">.</span><span class="na">createTupleQuery</span><span class="p">();</span>
<span class="n">Root</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">criteria</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">tuple</span><span class="p">(</span>
<span class="hll"><span class="w">   </span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">nombre</span><span class="p">).</span><span class="na">alias</span><span class="p">(</span><span class="s">&quot;nombre&quot;</span><span class="p">),</span>
</span><span class="hll"><span class="w">   </span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">).</span><span class="na">alias</span><span class="p">(</span><span class="s">&quot;centro&quot;</span><span class="p">)</span>
</span><span class="p">));</span>

<span class="n">TypedQuery</span><span class="o">&lt;</span><span class="n">Tuple</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">em</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>A partir de ahora usaremos las metaclases para referir atributos.</p>
</div>
</section>
<section id="condiciones">
<h2><span class="section-number">5.6.2.2.3. </span>Condiciones<a class="headerlink" href="#condiciones" title="Link to this heading">#</a></h2>
<p><a class="extlink-hibernate-api reference external" href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/query/criteria/HibernateCriteriaBuilder.html">CriteriaBuilder</a> tiene definidos métodos que implementan los operadores
básicos de <abbr title="Structured Query Language">SQL</abbr>. Por ejemplo, para escoger los estudiantes no matriculados:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">Root</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">query</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
<span class="hll"><span class="n">query</span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">isNull</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">)));</span>
</span>
<span class="n">TypedQuery</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">estudiantes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sesion</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
</pre></div>
</div>
<p>Para obtener los estudiantes de un centro determinado (suponiendo que éste
se almacene en la variable <code class="docutils literal notranslate"><span class="pre">centro</span></code>) la condición habría sido:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">query</span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">equal</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">),</span><span class="w"> </span><span class="n">centro</span><span class="p">));</span>
</pre></div>
</div>
</section>
<section id="ordenacion">
<h2><span class="section-number">5.6.2.2.4. </span>Ordenación<a class="headerlink" href="#ordenacion" title="Link to this heading">#</a></h2>
<p>Para ordenar resultados basta con aplicar el orden a <code class="docutils literal notranslate"><span class="pre">criteria</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">Root</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">criteria</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
<span class="hll"><span class="n">criteria</span><span class="p">.</span><span class="na">orderBy</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">desc</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">nacimiento</span><span class="p">)));</span>
</span>
<span class="n">TypedQuery</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">em</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">criteria</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="agrupacion">
<h2><span class="section-number">5.6.2.2.5. </span>Agrupación<a class="headerlink" href="#agrupacion" title="Link to this heading">#</a></h2>
<p>También existe el equivalente a <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Tuple</span><span class="o">&gt;</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Tuple</span><span class="p">);</span>
<span class="n">Root</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">criteria</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">tuple</span><span class="p">(</span>
<span class="w">   </span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">).</span><span class="na">alias</span><span class="p">(</span><span class="s">&quot;centro&quot;</span><span class="p">),</span>
<span class="w">   </span><span class="n">cb</span><span class="p">.</span><span class="na">count</span><span class="p">(</span><span class="n">root</span><span class="p">).</span><span class="na">alias</span><span class="p">(</span><span class="s">&quot;cantidad&quot;</span><span class="p">)</span>
<span class="p">));</span>
<span class="hll"><span class="n">criteria</span><span class="p">.</span><span class="na">groupBy</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">));</span>
</span>
<span class="n">TypedQuery</span><span class="o">&lt;</span><span class="n">Tuple</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sesion</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">query</span><span class="p">);</span>
</pre></div>
</div>
<p>Si ahora quisiéramos ordenar resultados por la cantidad de estudiantes que tiene
cada centro deberíamos añadir:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">criteria</span><span class="p">.</span><span class="na">orderBy</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">asc</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">count</span><span class="p">(</span><span class="n">root</span><span class="p">)));</span>
</pre></div>
</div>
<p>ya que no puede usarse el alias. O, si quisiéramos ordenar por el nombre del
centro:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">criteria</span><span class="p">.</span><span class="na">orderBy</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">asc</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">).</span><span class="na">get</span><span class="p">(</span><span class="n">Centro_</span><span class="p">.</span><span class="na">nombre</span><span class="p">)));</span>
</pre></div>
</div>
</section>
<section id="joins">
<h2><span class="section-number">5.6.2.2.6. </span>Joins<a class="headerlink" href="#joins" title="Link to this heading">#</a></h2>
<p>Como en <abbr title="Java Persistence Query Language">JPQL</abbr> también se puede relacionar fácilmente entidades. Esto permite
hacer un <code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">Root</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="hll"><span class="n">Join</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="p">,</span><span class="w"> </span><span class="n">Centro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">centro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="na">join</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">,</span><span class="w"> </span><span class="n">JoinType</span><span class="p">.</span><span class="na">INNER</span><span class="p">);</span>
</span><span class="n">criteria</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>

<span class="n">TypedQuery</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">em</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">criteria</span><span class="p">);</span>
</pre></div>
</div>
<p>La consulta equivale a:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Estudiante</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Centro</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">centro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</pre></div>
</div>
<p>Obsérvese que el <em>JOIN</em> viene representado por la variable <code class="docutils literal notranslate"><span class="pre">centro</span></code> que se
define en la línea remarcada. En cambio, si nuestra intención hubiera sido:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Estudiante</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">INNER</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Centro</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">centro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</pre></div>
</div>
<p>la consulta debería haberse construido así:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Centro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Centro</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">Root</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="hll"><span class="n">Join</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="p">,</span><span class="w"> </span><span class="n">Centro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">centro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="na">join</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">,</span><span class="w"> </span><span class="n">JoinType</span><span class="p">.</span><span class="na">INNER</span><span class="p">);</span>
</span><span class="n">criteria</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">centro</span><span class="p">);</span>

<span class="n">TypedQuery</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">em</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">criteria</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Obtendremos muchos centros repetidos así que lo suyo sería haber hecho
un <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">criteria</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">distinct</span><span class="p">(</span><span class="n">centro</span><span class="p">));</span>
</pre></div>
</div>
<p>que devolvería la lista de centros con algún estudiante matriculado.</p>
</div>
<p>Si intentáramos obtener lo contrario, la relación de centros sin alumnos
matriculados, en <abbr title="Structured Query Language">SQL</abbr> podríamos obtenerla con una de estas dos consultas, que
son equivalentes:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Centro</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">LEFT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Estudiante</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">centro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">centro</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
<span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Estudiante</span><span class="w"> </span><span class="n">e</span><span class="w"> </span><span class="k">RIGHT</span><span class="w"> </span><span class="k">JOIN</span><span class="w"> </span><span class="n">Centro</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">centro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">centro</span><span class="w"> </span><span class="k">IS</span><span class="w"> </span><span class="k">NULL</span><span class="p">;</span>
</pre></div>
</div>
<p>Al intentar trasladar esto a <em>Criteria API</em> nos encontraríamos con los siguientes
problemas:</p>
<p>La primera expresión podríamos traducirla así:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Centro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Centro</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">Root</span><span class="o">&lt;</span><span class="n">Centro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Centro</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="hll"><span class="n">Join</span><span class="o">&lt;</span><span class="n">Centro</span><span class="p">,</span><span class="w"> </span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">estudiante</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="na">join</span><span class="p">(</span><span class="n">Centro_</span><span class="p">.</span><span class="na">estudiantes</span><span class="p">,</span><span class="w"> </span><span class="n">JoinType</span><span class="p">.</span><span class="na">LEFT</span><span class="p">);</span>
</span><span class="n">criteria</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">centro</span><span class="p">);</span>
<span class="hll"><span class="n">criteria</span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Centro_</span><span class="p">.</span><span class="na">estudiantes</span><span class="p">)));</span>
</span></pre></div>
</div>
<p>Obsérvese que en la relación <code class="docutils literal notranslate"><span class="pre">root</span></code> hace referencia a un objeto
<code class="docutils literal notranslate"><span class="pre">Centro</span></code>, luego debemos indicar el campo que liga <code class="docutils literal notranslate"><span class="pre">Centro</span></code> con
<code class="docutils literal notranslate"><span class="pre">Estudiante</span></code>. Es la lista de estudiantes… pero sólo si definimos como
bidireccional la relación. Si la relación es unidireccional el único campo que
establece la relación está en <code class="docutils literal notranslate"><span class="pre">Estudiante</span></code> y no podremos resolver de este modo
el problema. Por su parte, la condición es trivial: la lista de estudiantes debe
estar vacía.</p>
<p>La segunda expresión si tiene teóricamente, pero sólo teóricamente, solución:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Esto NO VALE. Ni se le ocurra intentarlo.</span>
<span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Centro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Centro</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">Root</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">Join</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="p">,</span><span class="w"> </span><span class="n">Centro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">centro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="na">join</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">,</span><span class="w"> </span><span class="n">JoinType</span><span class="p">.</span><span class="na">RIGHT</span><span class="p">);</span>
<span class="n">criteria</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">centro</span><span class="p">);</span>
<span class="n">criteria</span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">isNull</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">)));</span>
</pre></div>
</div>
<p>El problema es que Criteria API <strong>no</strong> implementa <code class="docutils literal notranslate"><span class="pre">RIGHT</span> <span class="pre">JOIN</span></code> sino solamente
los tipos ya vistos: <code class="docutils literal notranslate"><span class="pre">INNER</span> <span class="pre">JOIN</span></code> y <code class="docutils literal notranslate"><span class="pre">LEFT</span> <span class="pre">JOIN</span></code>.</p>
<p class="rubric" id="orm-subquery">Subconsultas</p>
<p>En consecuencia, el único modo de hacer la consulta con una relación
unidireccional es recurrir a una <strong>subconsulta</strong>:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Centro</span><span class="w"> </span><span class="k">c</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="k">SELECT</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">Estudiante</span><span class="w"> </span><span class="n">e</span><span class="p">);</span>
</pre></div>
</div>
<p>lo que da pie a que intentemos implementar está consulta con subconsulta usando
<em>Criteria API</em>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Centro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Centro</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">Root</span><span class="o">&lt;</span><span class="n">Centro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Centro</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="c1">// Preparamos la subconsulta</span>
<span class="n">Subquery</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span><span class="w"> </span><span class="n">subquery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="na">subquery</span><span class="p">(</span><span class="n">Long</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">Root</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">subroot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">subquery</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">subquery</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">subroot</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">));</span>
<span class="c1">// Consulta con subconsulta</span>
<span class="n">criteria</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
<span class="n">criteria</span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">not</span><span class="p">(</span><span class="n">root</span><span class="p">).</span><span class="na">in</span><span class="p">(</span><span class="n">subquery</span><span class="p">));</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>Nótese que aquí podemos comparar directamente centros en vez de
identificadores de centros.</p>
</div>
<p class="rubric">Cadena de consultas</p>
<p>Observemos parte del código ya presentado anteriormente:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">Root</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">Join</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="p">,</span><span class="w"> </span><span class="n">Centro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">centro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="na">join</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">,</span><span class="w"> </span><span class="n">JoinType</span><span class="p">.</span><span class="na">INNER</span><span class="p">);</span>
<span class="n">criteria</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
</pre></div>
</div>
<p>Partidos de <code class="docutils literal notranslate"><span class="pre">Estudiante</span></code> (root) y relacionamos con <code class="docutils literal notranslate"><span class="pre">Centro</span></code> a través del
atributo <code class="docutils literal notranslate"><span class="pre">centro</span></code> de <code class="docutils literal notranslate"><span class="pre">Estudiante</span></code>, de ahí que la relación se escriba así:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Join</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="p">,</span><span class="w"> </span><span class="n">Centro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">centro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="na">join</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">,</span><span class="w"> </span><span class="n">JoinType</span><span class="p">.</span><span class="na">INNER</span><span class="p">);</span>
</pre></div>
</div>
<p>O sea, para relacionar con <code class="docutils literal notranslate"><span class="pre">Centro</span></code>, <em>juntamos</em> <code class="docutils literal notranslate"><span class="pre">root</span></code> (que es
<code class="docutils literal notranslate"><span class="pre">Estudiante</span></code>) a través de su atributo llamado <code class="docutils literal notranslate"><span class="pre">centro</span></code>. Si deseamos que en
la consulta participe una segunda relación, deberemos tener en cuenta con qué
entidad se relaciona. Si la tercera entidad fuera la entidad <code class="docutils literal notranslate"><span class="pre">Grupo</span></code>
relacionada con <code class="docutils literal notranslate"><span class="pre">Estudiante</span></code> entonces tendríamos que hacer:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Join</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="p">,</span><span class="w"> </span><span class="n">Centro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">centro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="na">join</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">,</span><span class="w"> </span><span class="n">JoinType</span><span class="p">.</span><span class="na">INNER</span><span class="p">);</span>
<span class="hll"><span class="n">Join</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="p">,</span><span class="w"> </span><span class="n">Curso</span><span class="o">&gt;</span><span class="w"> </span><span class="n">curso</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="na">join</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">curso</span><span class="p">,</span><span class="w"> </span><span class="n">JoinType</span><span class="p">.</span><span class="na">INNER</span><span class="p">);</span>
</span></pre></div>
</div>
<p>En cambio, si la tercera entidad fuera la entidad <code class="docutils literal notranslate"><span class="pre">ComunidadA</span></code> relacionada con
<code class="docutils literal notranslate"><span class="pre">Centro</span></code>, entonces la relación se establecería así:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Join</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="p">,</span><span class="w"> </span><span class="n">Centro</span><span class="o">&gt;</span><span class="w"> </span><span class="n">centro</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="na">join</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">,</span><span class="w"> </span><span class="n">JoinType</span><span class="p">.</span><span class="na">INNER</span><span class="p">);</span>
<span class="hll"><span class="n">Join</span><span class="o">&lt;</span><span class="n">Centro</span><span class="p">,</span><span class="w"> </span><span class="n">ComunidadA</span><span class="o">&gt;</span><span class="w"> </span><span class="n">comunidad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">centro</span><span class="p">.</span><span class="na">join</span><span class="p">(</span><span class="n">Centro_</span><span class="p">.</span><span class="na">comunidad</span><span class="p">,</span><span class="w"> </span><span class="n">JoinType</span><span class="p">.</span><span class="na">INNER</span><span class="p">);</span>
</span></pre></div>
</div>
<p class="rubric">Carga inmediata</p>
<p>COmo en el caso de <abbr title="Java Persistence Query Language">JPQL</abbr> puede forzarse una carga inmediata de la entidad
relacionada sustituyendo el método <code class="docutils literal notranslate"><span class="pre">.join</span></code> por el método <code class="docutils literal notranslate"><span class="pre">.fetch</span></code> en los
ejemplos de este epígrafe en que existen <em>JOINs</em> explícitos:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// ...</span>
<span class="n">Join</span><span class="o">&lt;</span><span class="n">Centro</span><span class="p">,</span><span class="w"> </span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">estudiante</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">root</span><span class="p">.</span><span class="na">fetch</span><span class="p">(</span><span class="n">Centro_</span><span class="p">.</span><span class="na">estudiantes</span><span class="p">,</span><span class="w"> </span><span class="n">JoinType</span><span class="p">.</span><span class="na">LEFT</span><span class="p">);</span>
<span class="c1">// ...</span>
</pre></div>
</div>
<p>Ahora bien, ¿qué ocurre cuando la relación no es explícita?</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">CriteriaQuery</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">criteria</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">Root</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">criteria</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="hll"><span class="n">root</span><span class="p">.</span><span class="na">fetch</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">,</span><span class="w"> </span><span class="n">JoinType</span><span class="p">.</span><span class="na">LEFT</span><span class="p">));</span>
</span><span class="n">criteria</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
</pre></div>
</div>
<p>La respuesta es que basta con hacerla explícito para poder usar el método
<code class="docutils literal notranslate"><span class="pre">.fetch</span></code>.</p>
<div class="admonition seealso">
<p class="admonition-title">Ver también</p>
<p>Consulte para más información el <a class="reference internal" href="../../15.extra.html#orm-optimo"><span class="std std-ref">epígrafe dedicado a
optimización</span></a>.</p>
</div>
</section>
<section id="actualizacion-y-borrado">
<h2><span class="section-number">5.6.2.2.7. </span>Actualización y borrado<a class="headerlink" href="#actualizacion-y-borrado" title="Link to this heading">#</a></h2>
<p>Al igual que <abbr title="Java Persistence Query Language">JPQL</abbr>, también se puede <strong>actualizar</strong> objetos. Por ejemplo, esto
desmatricularía a todos los estudiantes cuyo nombre empieza por «J»:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">CriteriaUpdate</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createCriteriaUpdate</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">Root</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">update</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">centro</span><span class="p">),</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="n">update</span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">like</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">nombre</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;J%&quot;</span><span class="p">));</span>

<span class="n">em</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">update</span><span class="p">).</span><span class="na">executeUpdate</span><span class="p">();</span>
</pre></div>
</div>
<p>También es posible <strong>borrar</strong>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">CriteriaDelete</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">delete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cb</span><span class="p">.</span><span class="na">createCriteriaDelete</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">Root</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delete</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">delete</span><span class="p">.</span><span class="na">where</span><span class="p">(</span><span class="n">cb</span><span class="p">.</span><span class="na">like</span><span class="p">(</span><span class="n">root</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">Estudiante_</span><span class="p">.</span><span class="na">nombre</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;J%&quot;</span><span class="p">));</span>

<span class="n">em</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="n">delete</span><span class="p">).</span><span class="na">executeUpdate</span><span class="p">();</span>
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="01.hql.html"
       title="página anterior">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">anterior</p>
        <p class="prev-next-title"><span class="section-number">5.6.2.1. </span><abbr title="Java Persistence Query Language">JPQL</abbr></p>
      </div>
    </a>
    <a class="right-next"
       href="03.nativo.html"
       title="siguiente página">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">siguiente</p>
        <p class="prev-next-title"><span class="section-number">5.6.2.3. </span><abbr title="Structured Query Language">SQL</abbr> nativo</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenido
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#consulta-basica">5.6.2.2.1. Consulta básica</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#metamodel">5.6.2.2.2. Metamodel</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#condiciones">5.6.2.2.3. Condiciones</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ordenacion">5.6.2.2.4. Ordenación</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#agrupacion">5.6.2.2.5. Agrupación</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#joins">5.6.2.2.6. Joins</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#actualizacion-y-borrado">5.6.2.2.7. Actualización y borrado</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Por José Miguel Sánchez Alés
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright CC BY 4.0, 2024-2025, José Miguel Sánchez Alés.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>