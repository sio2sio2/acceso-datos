


<!DOCTYPE html>


<html lang="es" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5.7. Otros aspectos &#8212; documentación de Acceso a datos - rolling</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" href="../_static/general.css" type="text/css" />
    <link rel="stylesheet" href="../_static/particular.css" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=461dccb6"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=677778c1"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/translations.js?v=f85f4cfb"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '05.orm/15.extra';</script>
    <link rel="index" title="Índice" href="../genindex.html" />
    <link rel="search" title="Búsqueda" href="../search.html" />
    <link rel="next" title="Ejercicios" href="../99.ejercicios/index.html" />
    <link rel="prev" title="5.6.2.3. SQL nativo" href="10.crud/02.avanzadas/03.nativo.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="es"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Saltar al contenido principal</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Volver arriba</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Advertencia de versión"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.jpg" class="logo__image only-light" alt="documentación de Acceso a datos - rolling - Home"/>
    <script>document.write(`<img src="../_static/logo.jpg" class="logo__image only-dark" alt="documentación de Acceso a datos - rolling - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Búsqueda" aria-label="Búsqueda" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Búsqueda</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01.archivos/index.html">1. Tratamiento de archivos</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../01.archivos/01.gestion.html">1.1. Gestión de archivos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01.archivos/02.manipulacion.html">1.2. Consulta y manipulación de contenidos</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../02.formatos/index.html">2. Formatos de información</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../02.formatos/01.csv.html">2.1. <abbr title="Comma-Separated Values">CSV</abbr></a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../02.formatos/02.json.html">2.2. <abbr title="JavaScript Object Notation">JSON</abbr></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../02.formatos/02.json/01.jackson.html">2.2.1. Jackson</a></li>
<li class="toctree-l3"><a class="reference internal" href="../02.formatos/02.json/02.gson.html">2.2.2. GSON</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../02.formatos/03.yaml.html">2.3. <abbr title="YAML Ain't Markup Language">YAML</abbr></a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../03.xml/index.html">3. <abbr title="eXtensible Markup Language">XML</abbr></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../03.xml/01.jaxp.html">3.1. <abbr title="Java API for XML Processing">JAXP</abbr></a></li>
<li class="toctree-l2"><a class="reference internal" href="../03.xml/02.jackson.html">3.2. Jackson</a></li>
<li class="toctree-l2"><a class="reference internal" href="../03.xml/03.basex.html">3.3. BaseX</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../04.conector/index.html">4. Conectores</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../04.conector/01.basico.html">4.1. Operaciones básicas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04.conector/02.datos.html">4.2. Datos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04.conector/03.transacciones.html">4.3. Transacciones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04.conector/04.pool.html">4.4. <em>Pool</em> de conexiones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04.conector/10.extras.html">4.5. Extras</a></li>
<li class="toctree-l2"><a class="reference internal" href="../04.conector/15.dao.html">4.6. Programación con conectores</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">5. Herramientas <abbr title="Object-Relational Mapping">ORM</abbr></a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01.conf.html">5.1. Configuración</a></li>
<li class="toctree-l2"><a class="reference internal" href="02.basico.html">5.2. Operativa básica</a></li>
<li class="toctree-l2"><a class="reference internal" href="04.mapeo.html">5.3. Mapeo</a></li>
<li class="toctree-l2"><a class="reference internal" href="08.transaction.html">5.4. Transacciones</a></li>
<li class="toctree-l2"><a class="reference internal" href="09.dao.html">5.5. Estrategias de diseño</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="10.crud.html">5.6. Operaciones <abbr title="Create, Read, Update, Delete">CRUD</abbr></a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="10.crud/01.simples.html">5.6.1. Simples</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="10.crud/02.avanzadas.html">5.6.2. Avanzadas</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="10.crud/02.avanzadas/01.hql.html">5.6.2.1. <abbr title="Java Persistence Query Language">JPQL</abbr></a></li>
<li class="toctree-l4"><a class="reference internal" href="10.crud/02.avanzadas/02.criteria.html">5.6.2.2. Criteria API</a></li>
<li class="toctree-l4"><a class="reference internal" href="10.crud/02.avanzadas/03.nativo.html">5.6.2.3. <abbr title="Structured Query Language">SQL</abbr> nativo</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">5.7. Otros aspectos</a></li>
</ul>
</details></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../99.ejercicios/index.html">Ejercicios</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../99.ejercicios/01.archivos.html">1. Archivos</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99.ejercicios/02.formatos.html">2. Formatos de información</a></li>
<li class="toctree-l2"><a class="reference internal" href="../99.ejercicios/03.xml.html">3. Formato <abbr title="eXtensible Markup Language">XML</abbr></a></li>
<li class="toctree-l2"><a class="reference internal" href="../99.ejercicios/04.conectores.html">4. <abbr title="Java DataBase Connectivity">JDBC</abbr></a></li>
<li class="toctree-l2"><a class="reference internal" href="../99.ejercicios/05.orm.html">5. <abbr title="Java Persistent API">JPA</abbr></a></li>
</ul>
</details></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../98.apendices/index.html">Apéndices</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../98.apendices/01.funcional.html">1. Java funcional</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../98.apendices/01.funcional/01.function.html">1.1. Interfaces funcionales</a></li>
<li class="toctree-l3"><a class="reference internal" href="../98.apendices/01.funcional/05.collection.html">1.2. Colecciones</a></li>
<li class="toctree-l3"><a class="reference internal" href="../98.apendices/01.funcional/10.flujos.html">1.3. Flujos</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../98.apendices/05.pattern.html">2. Patrones de diseño</a></li>
<li class="toctree-l2"><a class="reference internal" href="../98.apendices/10.logging.html">3. Sistema de registros</a></li>
<li class="toctree-l2"><a class="reference internal" href="../98.apendices/15.cli.html">4. Análisis de la línea de órdenes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../98.apendices/80.maven.html">5. Maven</a></li>
<li class="toctree-l2"><a class="reference internal" href="../98.apendices/99.ide.html">6. Visual Studio Code</a></li>
</ul>
</details></li>
</ul>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../97.orientaciones/index.html">Orientaciones pedagógicas</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Descarga esta pagina">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/05.orm/15.extra.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Descargar archivo fuente"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Imprimir en PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Modo de pantalla completa"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="claro/oscuro" aria-label="claro/oscuro" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Búsqueda" aria-label="Búsqueda" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Otros aspectos</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenido </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#excepciones">5.7.1. Excepciones</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mapeo-avanzado">5.7.2. Mapeo avanzado</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cascada-de-operaciones">5.7.2.1. Cascada de operaciones</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mapeo-de-colecciones">5.7.2.2. Mapeo de colecciones</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#concurrencia">5.7.3. Concurrencia</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bloqueo-optimista">5.7.3.1. Bloqueo optimista</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bloqueo-pesimista">5.7.3.2. Bloqueo pesimista</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimizacion">5.7.4. Optimización</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mapeo-mediante-archivos">5.7.5. Mapeo mediante archivos</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definicion-del-esquema">5.7.5.1. Definición del esquema</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definicion-de-restricciones">5.7.5.2. Definición de restricciones</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="otros-aspectos">
<span id="orm-extra"></span><h1><span class="section-number">5.7. </span>Otros aspectos<a class="headerlink" href="#otros-aspectos" title="Link to this heading">#</a></h1>
<section id="excepciones">
<span id="orm-exp"></span><h2><span class="section-number">5.7.1. </span>Excepciones<a class="headerlink" href="#excepciones" title="Link to this heading">#</a></h2>
<p><abbr title="Java Persistence API">JPA</abbr> define su propio conjunto de excepciones derivadas todas de
<a class="extlink-jakarta-persistence reference external" href="https://jakarta.ee/specifications/persistence/3.2/apidocs/jakarta.persistence/jakarta/persistence/PersistenceException">PersistenceException</a>, que a su vez deriva
de <a class="extlink-java-lang reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/RuntimeException.html">RuntimeException</a>. Hay que tener en cuenta
dos particularidades:</p>
<ul class="simple">
<li><p>Que todas deriven en última instancia de <a class="extlink-java-lang reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/lang/RuntimeException.html">RuntimeException</a>, supone que las excepciones de este <abbr title="Object-Relational Mapping">ORM</abbr>, a diferencia de
las de <a class="reference internal" href="../04.conector/index.html#conn"><span class="std std-ref">JBDC</span></a>, no son comprobadas; y, por tanto, no es necesario
capturarlas o declararlas a través de <code class="docutils literal notranslate"><span class="pre">throws</span></code>.</p></li>
<li><p>Cuando se genera una excepción, la sesión suele quedar en estado
inconsistente, por lo que conviene cerrarla y comenzar una nueva.</p></li>
</ul>
<p class="rubric">Excepciones comunes</p>
<p>Una lista no exhaustiva de excepciones es esta:</p>
<dl class="simple">
<dt><a class="extlink-jakarta-persistence reference external" href="https://jakarta.ee/specifications/persistence/3.2/apidocs/jakarta.persistence/jakarta/persistence/NoResultException">NoResultException</a>, <a class="extlink-jakarta-persistence reference external" href="https://jakarta.ee/specifications/persistence/3.2/apidocs/jakarta.persistence/jakarta/persistence/NonUniqueResultException">NonUniqueResultException</a></dt><dd><p>Se producen cuando se espera un único resultado (véase
<a class="reference internal" href="10.crud/02.avanzadas/01.hql.html#orm-singleresult"><span class="std std-ref">.getSingleResult()</span></a>) y no se obtiene eso.</p>
</dd>
<dt><a class="extlink-jakarta-persistence reference external" href="https://jakarta.ee/specifications/persistence/3.2/apidocs/jakarta.persistence/jakarta/persistence/OptimisticLockException">OptimisticLockException</a></dt><dd><p>Esta relacionada con problemas de concurrencia: se lanza cuando se detecta
que una entidad se modificó por otra transacción después de haber sido
recuperada por la actual.</p>
</dd>
<dt><a class="extlink-jakarta-persistence reference external" href="https://jakarta.ee/specifications/persistence/3.2/apidocs/jakarta.persistence/jakarta/persistence/RollbackException">RollbackException</a></dt><dd><p>Se produce cuando una transacción no puede confirmarse, por lo general por
violarse restricciones en los valores de los campos.</p>
</dd>
<dt><a class="extlink-jakarta-persistence reference external" href="https://jakarta.ee/specifications/persistence/3.2/apidocs/jakarta.persistence/jakarta/persistence/TransactionRequiredException">TransactionRequiredException</a></dt><dd><p>Se lanza cuando se intenta hacer una operación de escritura sin haber
iniciado una transacción.</p>
</dd>
</dl>
<p>Dependiendo de qué proveedor se use, además de las genéricas, pueden lanzarse
otras, como estas específicas de <a class="reference external" href="https://hibernate.org/">Hibernate</a>:</p>
<dl class="simple">
<dt><a class="extlink-hibernate-api reference external" href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/exception/JDBCConnectionException.html">JDBCConnectionException</a></dt><dd><p>Producida por problemas en la conexión a la base de datos como que ésta no
exista o no haya conectividad o las credenciales sean inválidas.</p>
</dd>
<dt><a class="extlink-hibernate-api reference external" href="https://docs.jboss.org/hibernate/orm/7.0/javadocs/org/hibernate/LazyInitializationException.html">LazyInitializationException</a></dt><dd><p>Se produce cuando se intenta resolver una relación perezosa sin que el objeto
esté asociado a la sesión activa.</p>
</dd>
</dl>
</section>
<section id="mapeo-avanzado">
<span id="orm-adv-mapping"></span><h2><span class="section-number">5.7.2. </span>Mapeo avanzado<a class="headerlink" href="#mapeo-avanzado" title="Link to this heading">#</a></h2>
<p>Incluimos bajo este epígrafe otros aspectos más específicos que se reflejan al
anotar las clases.</p>
<section id="cascada-de-operaciones">
<h3><span class="section-number">5.7.2.1. </span>Cascada de operaciones<a class="headerlink" href="#cascada-de-operaciones" title="Link to this heading">#</a></h3>
<p>Cuando dos entidades se relaciones entre sí, los cambios en uno de los extremos
pueden afectar al otro.</p>
<p class="rubric"><abbr title="Structured Query Language">SQL</abbr></p>
<p>En <abbr title="Structured Query Language">SQL</abbr>, al definir la relación con una clave foránea puede especificarse qué
ocurre con la entidad hijo<a class="footnote-reference brackets" href="#id3" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> cuando la entidad padre se elimina (<code class="docutils literal notranslate"><span class="pre">ON</span>
<span class="pre">DELETE</span></code>) o cuando el identificador de la entidad padre se actualiza (<code class="docutils literal notranslate"><span class="pre">ON</span>
<span class="pre">UPDATE</span></code>)<a class="footnote-reference brackets" href="#id4" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>. Esto efectos son:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">CASCADE</span></code></dt><dd><p>aplicar también la operación a la entidad hijo, lo que se traduce en borrar
la entidad hijo si la entidad padre se borró; o actualizar el valor de la
clave foránea, si se actualizó el identificador del padre.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">NULL</span></code></dt><dd><p>poner a nulo la clave foránea.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">SET</span> <span class="pre">DEFAULT</span></code></dt><dd><p>poner un valor predeterminado (el que se especifique a continuación) como
valor de la clave foránea.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">RESTRICT</span></code></dt><dd><p>impedir la operación.</p>
</dd>
</dl>
<p><abbr title="Java Persistence API">JPA</abbr>, tanto si la relación es unidireccional como bidireccional, permite
añadir la anotación <code class="docutils literal notranslate"><span class="pre">&#64;OnDelete</span></code> en el lado propietario (el que tiene la clave
foránea) para notar el comportamiento <code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">DELETE</span></code>, aunque sólo se soporta el
efecto <code class="docutils literal notranslate"><span class="pre">CASCADE</span></code>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@ManyToOne</span>
<span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;id_centro&quot;</span><span class="p">)</span>
<span class="nd">@OnDelete</span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OnDeleteAction</span><span class="p">.</span><span class="na">CASCADE</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">Centro</span><span class="w"> </span><span class="n">centro</span><span class="p">;</span>
</pre></div>
</div>
<p>De este modo, se añadirá en el esquema <code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">DELETE</span> <span class="pre">CASCADE</span></code> y la base de datos
se encargará de propagar la operación en cascada.</p>
<div class="admonition caution">
<p class="admonition-title">Prudencia</p>
<p>En SQLite la integridad referencial está deshabilitada por defecto.</p>
</div>
<p class="rubric"><abbr title="Java Persistence API">JPA</abbr></p>
<div class="admonition caution">
<p class="admonition-title">Prudencia</p>
<p>Por lo general, las operaciones en cascada se definen de padre a
hijo cuando las relaciones son bidireccionales. Cuando las relaciones son
unidireccionales, las operaciones en cascada pueden definirse también y se
aplican de hijo a padre, pero no suelen ser buena idea por provocar
inconsistencias y, por lo general, es mejor evitarlas.</p>
</div>
<p><abbr title="Java Persistence API">JPA</abbr> permite desencadenar efectos adicionales en el nivel de aplicación
sobre las entidades <em>hijo</em> cuando se realiza una operación en la entidad
<em>padre</em>. Para aclararnos recordemos que para la relación bidireccional entre
<code class="docutils literal notranslate"><span class="pre">Centro</span></code> (entidad padre) y <code class="docutils literal notranslate"><span class="pre">Estudiante</span></code> (entidad hijo) hemos definido lo
siguiente:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Estudiante</span>

<span class="nd">@ManyToOne</span>
<span class="nd">@JoinColumn</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;id_centro&quot;</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">Centro</span><span class="w"> </span><span class="n">centro</span>
</pre></div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// Centro</span>

<span class="nd">@OneToMany</span><span class="p">(</span><span class="n">mappedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;centro&quot;</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">estudiantes</span><span class="p">;</span>
</pre></div>
</div>
<p>Pueden definirse los siguientes <em>tipos de cascada</em>:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">CascadeType.PERSIST</span></code></dt><dd><p>Provoca que guardar la entidad <em>padre</em> provoque que se guarden también las
entidades <em>hijo</em>. En nuestro ejemplo, guardar un objeto <code class="docutils literal notranslate"><span class="pre">Centro</span></code> implicará
también que se guarden los nuevos objetos <code class="docutils literal notranslate"><span class="pre">Estudiante</span></code> que se hayan añadido
a su lista de matriculados.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CascadeType.MERGE</span></code></dt><dd><p>Provoca que la actualización de la entidad <em>padre</em> provoca una actualización
de todas las entidades <em>hijo</em> con la que está relacionada. Entiéndase como si
internamente se recorriera la lista de entidades hijo y se le aplicara a
todas ellas el método <code class="docutils literal notranslate"><span class="pre">.merge</span></code>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CascadeType.REMOVE</span></code></dt><dd><p>Provoca que la eliminación de la entidad <em>padre</em>, provoque la eliminación de
todas las entidades <em>hijo</em>. Es, por tanto, el equivalente a <code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">DELETE</span>
<span class="pre">CASCADE</span></code>, pero hecho en el nivel de aplicación y no desencadenado por la
propia base de datos.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CascadeType.REFRESH</span></code></dt><dd><p>Provoca que refrescar la entidad <em>padre</em>, refresque también todas las
entidades <em>hijo</em>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CascadeType.DETACH</span></code></dt><dd><p>Propaga el desvinculamiento de la entidad <em>padre</em> a todas las entidades
<em>hijo</em>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">CascadeType.ALL</span></code></dt><dd><p>Equivale a haber configurado todas las anteriores.</p>
</dd>
</dl>
<p>A todas estos desencadenamientos debe añadirse la opción:</p>
<dl class="simple">
<dt><code class="code docutils literal notranslate"><span class="pre">orphanRemoval</span> <span class="pre">=</span> <span class="pre">true</span></code></dt><dd><p>Provoca la eliminación de la entidad <em>hijo</em> en la base de datos al eliminarla
de la lista en la entidad <em>padre</em>, es decir, desvincularla de ésta.</p>
</dd>
</dl>
<p>Estas anotaciones deben incluirse en el extremo de la entidad padre de las
relaciones bidireccionales:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@OneToMany</span><span class="p">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s2">&quot;centro&quot;</span><span class="p">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="p">{</span><span class="n">CascadeType</span><span class="o">.</span><span class="n">PERSIST</span><span class="p">,</span> <span class="n">CascadeType</span><span class="o">.</span><span class="n">REMOVE</span><span class="p">},</span> <span class="n">orphanRemoval</span> <span class="o">=</span> <span class="n">true</span><span class="p">)</span>
<span class="n">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span> <span class="n">estudiantes</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="mapeo-de-colecciones">
<h3><span class="section-number">5.7.2.2. </span>Mapeo de colecciones<a class="headerlink" href="#mapeo-de-colecciones" title="Link to this heading">#</a></h3>
<p>La anotación <code class="docutils literal notranslate"><span class="pre">&#64;ElementCollection</span></code> permite mapear colecciones de tipos básicos
(como <code class="docutils literal notranslate"><span class="pre">String</span></code>, <code class="docutils literal notranslate"><span class="pre">Integer</span></code> o <code class="docutils literal notranslate"><span class="pre">LocalDate</span></code>) sin que haya necesidad de  crear
una entidad aparte. Supongamos que quisiéramos añadir un listado de números de
teléfono a cada centro:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@ElementCollection</span>
<span class="nd">@CollectionTable</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Telefono&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">joinColumns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nd">@JoinColum</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;id_estudiante&quot;</span><span class="p">))</span>
<span class="nd">@Column</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;numero&quot;</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">telefonos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
</pre></div>
</div>
<p>Si no se permiten elementos repetidos, puedo optarse por un
<a class="extlink-java-util reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/util/HashSet.html">java.util.HashSet</a> en vez de un <a class="extlink-java-util reference external" href="https://docs.oracle.com/en/java/javase/23/docs/api/java.base/java/util/ArrayList.html">java.util.ArrayList</a>.</p>
<p class="rubric">Notas al pie</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id3" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>La entidad hijo es la entidad en que se sitúa la clave foránea y la
entidad padre aquella a la que referencia dicha clave y en la que, por tanto,
no se ha definido ningún campo extra para significar la relación. En nuestro
ejemplo, <code class="docutils literal notranslate"><span class="pre">Estudiante</span></code> es la entidad hijo y <code class="docutils literal notranslate"><span class="pre">Centro</span></code>, la entidad padre.</p>
</aside>
<aside class="footnote brackets" id="id4" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Sólo el identificador de la entidad padre, porque la clave foránea en la
entidad hijo sólo almacena el identificador. Si la entidad padre se actualiza
cambiando cualquier otro campo, no hay ningún efecto que reflejar</p>
</aside>
</aside>
</section>
</section>
<section id="concurrencia">
<span id="orm-concurrencia"></span><h2><span class="section-number">5.7.3. </span>Concurrencia<a class="headerlink" href="#concurrencia" title="Link to this heading">#</a></h2>
<p><abbr title="Java Persistence API">JPA</abbr> permite también controlar el acceso concurrente a la base de datos.
Nótese que, cuando hay dos o más accesos a la base de datos, uno de ellos puede
obtener datos y el otro, alterarlos después de aquel acceso. La consecuencia esa
que los datos obtenidos en esa primera sesión no serán exactamente iguales a los
que hay en la base de datos y eso puede dar lugar a situaciones de
inconsistencia. Para paliar estos problemas, hay dos estrategias de <strong>bloqueo</strong>.</p>
<section id="bloqueo-optimista">
<span id="orm-bloq-opt"></span><h3><span class="section-number">5.7.3.1. </span>Bloqueo optimista<a class="headerlink" href="#bloqueo-optimista" title="Link to this heading">#</a></h3>
<p>Este bloqueo se basa en el uso de un atributo anotado con <code class="docutils literal notranslate"><span class="pre">&#64;Version</span></code> que
signifique la versión del objeto, de modo que cada vez que se cambian sus
valores, el <abbr title="Object-Relational Mapping">ORM</abbr> se encarga de aumentar su versión. No tenemos que
preocuparnos por dotarlo de valor, por lo que podemos establecer su <em>getter</em>
como <code class="docutils literal notranslate"><span class="pre">protected</span></code>. Por ejemplo, si quisiéramos que <code class="docutils literal notranslate"><span class="pre">Centro</span></code> tuviera un
atributo de este tipo podríamos añadir a <a class="reference internal" href="02.basico.html#orm-bas-map"><span class="std std-ref">su definición</span></a> lo
siguiente:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@Version</span>
<span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">version</span><span class="p">;</span>

<span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getVersion</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">version</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setVersion</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">version</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="k">this</span><span class="p">.</span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">version</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ante un atributo de este tipo, cada vez que hagamos una operación de
actualización o borrado, el <abbr title="Object-Relational Mapping">ORM</abbr> comprobará que el valor almacenado en la
base de datos para este campo coincide con el del objeto que pretendemos borrar
o actualizar, y, en caso contrario, lanza una excepción
<a class="extlink-jakarta-persistence reference external" href="https://jakarta.ee/specifications/persistence/3.2/apidocs/jakarta.persistence/jakarta/persistence/OptimisticLockException">OptimisticLockException</a>.</p>
<p>Esta solución es ideal para situaciones en que las colisiones por concurrencia
no son frecuentes.</p>
</section>
<section id="bloqueo-pesimista">
<span id="orm-bloq-pes"></span><h3><span class="section-number">5.7.3.2. </span>Bloqueo pesimista<a class="headerlink" href="#bloqueo-pesimista" title="Link to this heading">#</a></h3>
<p>Este bloqueo es más adecuado cuando las colisiones son probables. Hay tres tipos
de bloqueo:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">PESSIMISTIC_READ</span></code>,</dt><dd><p>que bloquea sólo las lecturas.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PESSIMISTIC_WRITE</span></code></dt><dd><p>que bloquea tanto escrituras como lecturas.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">PESSIMISTIC_FORCE_INCREMENT</span></code>,</dt><dd><p>que equivale al anterior, pero, además, aumenta la versión en caso de que la
entidad sea versionada.</p>
</dd>
</dl>
<p>Para practicarlo sólo hay que obtener el objeto, indicando que queremos
bloquearlo:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">(</span><span class="n">EntityManager</span><span class="w"> </span><span class="n">em</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">emf</span><span class="p">.</span><span class="na">createEntityManager</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">   </span><span class="n">EntityTransaction</span><span class="w"> </span><span class="n">tx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">em</span><span class="p">.</span><span class="na">getTransaction</span><span class="p">();</span>
<span class="w">   </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">tx</span><span class="p">.</span><span class="na">begin</span><span class="p">();</span>
<span class="hll"><span class="w">      </span><span class="n">Centro</span><span class="w"> </span><span class="n">castillo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sesion</span><span class="p">.</span><span class="na">find</span><span class="p">(</span><span class="n">Centro</span><span class="p">.</span><span class="na">class</span><span class="p">,</span><span class="w"> </span><span class="mi">11004866L</span><span class="p">,</span><span class="w"> </span><span class="n">LockModeType</span><span class="p">.</span><span class="na">PESSIMISTIC_WRITE</span><span class="p">);</span>
</span><span class="w">      </span><span class="c1">// Acabamos de bloquear ese registro, así</span>
<span class="w">      </span><span class="c1">// que ninguna otra sesión concurrente podrá</span>
<span class="w">      </span><span class="c1">// leer o escribir este registro durante la transacción.</span>

<span class="w">      </span><span class="c1">// ...</span>
<span class="w">      </span><span class="n">tx</span><span class="p">.</span><span class="na">commit</span><span class="p">();</span>
<span class="w">   </span><span class="p">}</span>
<span class="w">   </span><span class="k">catch</span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="p">(</span><span class="n">tx</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="na">isActive</span><span class="p">())</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="na">rollback</span><span class="p">();</span>
<span class="w">      </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">   </span><span class="p">}</span>

<span class="w">   </span><span class="c1">// Registro desbloqueado.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>El bloqueo sobre el registro dura hasta que se cierra la transacción en la que
se llevó a cabo.</p>
<p>Los bloqueos se pueden definir también sobre consultas y, en
ese caso, se aplicarán a todos los registros devueltos por la consulta:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// También podríamos haber usado Criteria API</span>
<span class="hll"><span class="n">TypedQuery</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">session</span><span class="p">.</span><span class="na">createQuery</span><span class="p">(</span><span class="s">&quot;FROM Estudiante&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Estudiante</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
</span><span class="n">query</span><span class="p">.</span><span class="na">setLockMode</span><span class="p">(</span><span class="n">LockModeType</span><span class="p">.</span><span class="na">PESSIMISTIC_WRITE</span><span class="p">);</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">Estudiante</span><span class="o">&gt;</span><span class="w"> </span><span class="n">estudiantes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">query</span><span class="p">.</span><span class="na">setResultList</span><span class="p">();</span><span class="w"> </span><span class="c1">// Todos están bloquedos</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Nota</p>
<p>En caso de obtener columnas sueltas, no registros enteros, el bloqueo
podría establecerse sólo por columnas si el <abbr title="Sistema Gestor de Bases de Datos">SGBD</abbr> lo soporta.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Prudencia</p>
<p>En <em>SQLite</em> los bloques se hacen para toda la base de datos, no se
pueden bloquer registros individuales.</p>
</div>
</section>
</section>
<section id="optimizacion">
<span id="orm-optimo"></span><h2><span class="section-number">5.7.4. </span>Optimización<a class="headerlink" href="#optimizacion" title="Link to this heading">#</a></h2>
<p>Así tratar <a class="reference internal" href="10.crud/02.avanzadas/01.hql.html#orm-jpql"><span class="std std-ref">JPQL</span></a> y <a class="reference internal" href="10.crud/02.avanzadas/02.criteria.html#orm-criteria"><span class="std std-ref">Criteria API</span></a>
indicamos que <em>fetch</em> permitía forzar una carga inmediata de las entidades
relacionadas. Ahora bien, ¿cuál es el comportamiento de <abbr title="Java Persistence API">JPA</abbr> ante las
relaciones?</p>
<p>Si al anotar una entidad no se especifica nada, las relaciones <code class="docutils literal notranslate"><span class="pre">&#64;ManyToOne</span></code> y
<code class="docutils literal notranslate"><span class="pre">&#64;OneToOne</span></code> cargan inmediatamente la entidad relacionada, mientras que las
relaciones <code class="docutils literal notranslate"><span class="pre">&#64;OneToMany</span></code> y <code class="docutils literal notranslate"><span class="pre">&#64;ManyToMany</span></code> lo hacen de forma perezosa:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@ManyToOne</span>
<span class="n">JoinColum</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;id_centro&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">Centro</span><span class="w"> </span><span class="n">centro</span><span class="p">;</span><span class="w"> </span><span class="c1">// Carga inmediata (eager).</span>

<span class="nd">@ManyToMany</span><span class="p">(</span><span class="n">mappedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;estudiantes&quot;</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Curso</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cursos</span><span class="p">;</span><span class="w"> </span><span class="c1">// Carga perezosa (lazy).</span>
</pre></div>
</div>
<p>Si quiere modificarse este comportamiento predeterminado, pueden añadirse
<code class="docutils literal notranslate"><span class="pre">FetchType.EAGER</span></code> o <code class="docutils literal notranslate"><span class="pre">FetchType.LAZY</span></code>, según convenga:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="nd">@ManyToOne</span><span class="p">(</span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">LAZY</span><span class="p">)</span>
<span class="n">JoinColum</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;id_centro&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">nullable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">Centro</span><span class="w"> </span><span class="n">centro</span><span class="p">;</span><span class="w"> </span><span class="c1">// Carga perezosa.</span>

<span class="nd">@ManyToMany</span><span class="p">(</span><span class="n">mappedBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;estudiantes&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fetch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FetchType</span><span class="p">.</span><span class="na">EAGER</span><span class="p">)</span>
<span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Curso</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cursos</span><span class="p">;</span><span class="w"> </span><span class="c1">// Carga inmediata.</span>
</pre></div>
</div>
<p>Tanto en <abbr title="Java Persistence Query Language">JPQL</abbr> como en <em>Criteria API</em>, los <em>JOIN</em> a secas respetan este
comportamiento derivado de las anotaciones, mientras que los <em>FETCH JOIN</em>
fuerzan siempre la carga inmediata.</p>
</section>
<section id="mapeo-mediante-archivos">
<span id="xml-orm-mapping"></span><h2><span class="section-number">5.7.5. </span>Mapeo mediante archivos<a class="headerlink" href="#mapeo-mediante-archivos" title="Link to this heading">#</a></h2>
<p>Aunque, como ya hemos visto, el mapeo puede realizarse mediante <a class="reference internal" href="04.mapeo.html#orm-mapping"><span class="std std-ref">anotaciones al
propio código de las clases del modelo</span></a>, también es posible no
añadir las anotaciones al código Java y crear archivos <abbr title="eXtensible Markup Language">XML</abbr> aparte que
sustituyan por completo a estas anotaciones. Para entender cómo crear estos
archivos es indispensable que entendamos que las anotaciones eran de dos
naturalezas distintas:</p>
<ul class="simple">
<li><p>Las que definían propiamente el esquema (como <code class="docutils literal notranslate"><span class="pre">&#64;Id</span></code> o <code class="docutils literal notranslate"><span class="pre">&#64;Colum</span></code>).</p></li>
<li><p>Las que incorporaban restricciones a los valores (como <code class="docutils literal notranslate"><span class="pre">&#64;Positive</span></code>).</p></li>
</ul>
<p>En los archivos ambas deben realizarse por separado, así que las trataremos bajo
epígrafes distintos:</p>
<section id="definicion-del-esquema">
<h3><span class="section-number">5.7.5.1. </span>Definición del esquema<a class="headerlink" href="#definicion-del-esquema" title="Link to this heading">#</a></h3>
<p>Antes de crear el archivo para <em>definir el esquema</em> debemos indicar en la
configuración de la unidad de persistencia definida en
<code class="file docutils literal notranslate"><span class="pre">META-INF/persistence.xml</span></code> cuál será tal archivo:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;persistenceo-unit</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;MiUnidadP&quot;</span><span class="w"> </span><span class="na">transaction-type=</span><span class="s">&quot;RESOURCE_LOCAL&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="cm">&lt;!-- Pueden definirse varios &lt;mapping-file&gt; --&gt;</span>
<span class="w">   </span><span class="nt">&lt;mapping-file&gt;</span>META-INF/schema.xml<span class="nt">&lt;/mapping-file&gt;</span>

<span class="w">   </span><span class="cm">&lt;!-- ... --&gt;</span>

<span class="w">   </span><span class="cm">&lt;!-- Es bastante probable que no necesitemos declarar las clases con &lt;class&gt; --&gt;</span>

<span class="nt">&lt;/presistence-unit&gt;</span>
</pre></div>
</div>
<p>Hecho lo cual, podemos definir <code class="file docutils literal notranslate"><span class="pre">META-INF/schema.xml</span></code> con la definición del
esquema:</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Definición del esquema SQL</span><a class="headerlink" href="#id5" title="Link to this code">#</a></div>
<div class="toggle highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;entity-mappings</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;2.2&quot;</span>
<span class="w">    </span><span class="na">xmlns=</span><span class="s">&quot;http://xmlns.jcp.org/xml/ns/persistence/orm&quot;</span>
<span class="w">    </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://xmlns.jcp.org/xml/ns/persistence/orm </span>
<span class="s">        http://xmlns.jcp.org/xml/ns/persistence/orm_2_2.xsd&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;entity</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;edu.acceso.ejemplo.modelo.Centro&quot;</span><span class="w"> </span><span class="na">access=</span><span class="s">&quot;FIELD&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;table</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Centro&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;attributes&gt;</span>
<span class="w">            </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;id&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;generated-value</span><span class="w"> </span><span class="na">strategy=</span><span class="s">&quot;IDENTITY&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/id&gt;</span>
<span class="w">            </span><span class="nt">&lt;basic</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nombre&quot;</span><span class="nt">&gt;</span>
<span class="w">               </span><span class="cm">&lt;!-- El atributo name permite que la columna en la BD se llame</span>
<span class="cm">                    de distinta forma --&gt;</span>
<span class="w">                </span><span class="nt">&lt;column</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nombre&quot;</span><span class="w"> </span><span class="na">nullable=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;255&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/basic&gt;</span>
<span class="w">            </span><span class="nt">&lt;basic</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;titularidad&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="cm">&lt;!-- El Enum se almacenará como un número --&gt;</span>
<span class="w">                </span><span class="nt">&lt;enumerated&gt;</span>ORDINAL<span class="nt">&lt;/enumerated&gt;</span>
<span class="w">            </span><span class="nt">&lt;/basic&gt;</span>
<span class="w">            </span><span class="cm">&lt;!--</span>
<span class="cm">            &lt;one-to-many name=&quot;estudiantes&quot; target-entity=&quot;educ.acceso.ejemplo.modelo.Estudiante&quot; mapped-by=&quot;centro&quot;&gt;</span>
<span class="cm">               &lt;cascade&gt;</span>
<span class="cm">                  &lt;cascade-type&gt;ALL&lt;/cascade-type&gt;</span>
<span class="cm">               &lt;cascade&gt;</span>
<span class="cm">            &lt;/one-to-many&gt;</span>
<span class="cm">            --&gt;</span>
<span class="w">        </span><span class="nt">&lt;/attributes&gt;</span>
<span class="w">    </span><span class="nt">&lt;/entity&gt;</span>

<span class="w">    </span><span class="nt">&lt;entity</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;edu.acceso.ejemplo.modelo.Estudiante&quot;</span><span class="w"> </span><span class="na">access=</span><span class="s">&quot;FIELD&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;table</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Estudiante&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;attributes&gt;</span>
<span class="w">            </span><span class="nt">&lt;id</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;id&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="cm">&lt;!-- o SEQUENCE si queremos que se genere automáticamente --&gt;</span>
<span class="w">                </span><span class="nt">&lt;generated-value</span><span class="w"> </span><span class="na">strategy=</span><span class="s">&quot;IDENTITY&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/id&gt;</span>
<span class="w">            </span><span class="nt">&lt;basic</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nombre&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;column</span><span class="w"> </span><span class="na">nullable=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="na">length=</span><span class="s">&quot;255&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/basic&gt;</span>
<span class="w">            </span><span class="nt">&lt;basic</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nacimiento&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="cm">&lt;!-- Optional permite valores nulos para el atributo (datos en la aplicación) --&gt;</span>
<span class="w">            </span><span class="nt">&lt;many-to-one</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;centro&quot;</span><span class="w"> </span><span class="na">target-entity=</span><span class="s">&quot;edu.acceso.ejemplo.modelo.Centro&quot;</span><span class="w"> </span><span class="na">fetch=</span><span class="s">&quot;EAGER&quot;</span><span class="w"> </span><span class="na">optional=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="cm">&lt;!-- nullable permite valores nulos en el esquema --&gt;</span>
<span class="w">                </span><span class="nt">&lt;join-column</span><span class="w"> </span><span class="na">nullable=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/many-to-one&gt;</span>
<span class="w">        </span><span class="nt">&lt;/attributes&gt;</span>
<span class="w">    </span><span class="nt">&lt;/entity&gt;</span>
<span class="nt">&lt;/entity-mappings&gt;</span>
</pre></div>
</div>
</div>
<p>En el archivo se ha definido una relación <em>unidirección</em>. Podríamos hacerla
<em>bidireccional</em> descomentando las líneas correspondientes en la definición de la
entidad padre (aunque deberíamos haber definido el atributo <code class="docutils literal notranslate"><span class="pre">estudiantes</span></code> en
la clase <code class="docutils literal notranslate"><span class="pre">Centro</span></code>).</p>
</section>
<section id="definicion-de-restricciones">
<h3><span class="section-number">5.7.5.2. </span>Definición de restricciones<a class="headerlink" href="#definicion-de-restricciones" title="Link to this heading">#</a></h3>
<p>Para definir restricciones <strong>a nivel de aplicación</strong> debemos escribir el archivo
<code class="docutils literal notranslate"><span class="pre">META-INF/validation</span></code>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;validation-config</span>
<span class="w">    </span><span class="na">xmlns=</span><span class="s">&quot;http://xmlns.jcp.org/xml/ns/validation/configuration&quot;</span>
<span class="w">    </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://xmlns.jcp.org/xml/ns/validation/configuration</span>
<span class="s">        http://xmlns.jcp.org/xml/ns/validation/validation-configuration-2.0.xsd&quot;</span>
<span class="w">    </span><span class="na">version=</span><span class="s">&quot;2.0&quot;</span><span class="nt">&gt;</span>

<span class="hll"><span class="w">    </span><span class="cm">&lt;!-- Podemos añadir más elementos &lt;constraint-mapping&gt; para repartir</span>
</span><span class="cm">         la configuración en varios archivos. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;constraint-mapping&gt;</span>META-INF/constraints.xml<span class="nt">&lt;/constraint-mapping&gt;</span>
<span class="nt">&lt;/validation-config&gt;</span>
</pre></div>
</div>
<p>Los archivos donde propiamente se definen las restricciones tienen esta pinta:</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Restricciones a nivel de aplicación</span><a class="headerlink" href="#id6" title="Link to this code">#</a></div>
<div class="toggle highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;constraint-mappings</span>
<span class="w">    </span><span class="na">xmlns=</span><span class="s">&quot;http://xmlns.jcp.org/xml/ns/validation/mapping&quot;</span>
<span class="w">    </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="w">    </span><span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://xmlns.jcp.org/xml/ns/validation/mapping</span>
<span class="s">        http://xmlns.jcp.org/xml/ns/validation/validation-mapping-2.0.xsd&quot;</span>
<span class="w">    </span><span class="na">version=</span><span class="s">&quot;2.0&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;edu.acceso.ejemplo.modelo.Centro&quot;</span><span class="w"> </span><span class="na">ignore-annotations=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nombre&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;constraint</span><span class="w"> </span><span class="na">annotation=</span><span class="s">&quot;jakarta.validation.constraints.NotNull&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;message&gt;</span>El<span class="w"> </span>nombre<span class="w"> </span>no<span class="w"> </span>puede<span class="w"> </span>ser<span class="w"> </span>nulo<span class="nt">&lt;/message&gt;</span>
<span class="w">            </span><span class="nt">&lt;/constraint&gt;</span>
<span class="w">            </span><span class="nt">&lt;constraint</span><span class="w"> </span><span class="na">annotation=</span><span class="s">&quot;jakarta.validation.constraints.Size&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;message&gt;</span>El<span class="w"> </span>nombre<span class="w"> </span>debe<span class="w"> </span>tener<span class="w"> </span>entre<span class="w"> </span>2<span class="w"> </span>y<span class="w"> </span>100<span class="w"> </span>caracteres<span class="nt">&lt;/message&gt;</span>
<span class="w">                </span><span class="nt">&lt;element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;min&quot;</span><span class="nt">&gt;</span>2<span class="nt">&lt;/element&gt;</span>
<span class="w">                </span><span class="nt">&lt;element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;max&quot;</span><span class="nt">&gt;</span>100<span class="nt">&lt;/element&gt;</span>
<span class="w">            </span><span class="nt">&lt;/constraint&gt;</span>
<span class="w">        </span><span class="nt">&lt;/field&gt;</span>
<span class="w">        </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;titularidad&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;constraint</span><span class="w"> </span><span class="na">annotation=</span><span class="s">&quot;jakarta.validation.constraints.NotNull&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;message&gt;</span>La<span class="w"> </span>titularidad<span class="w"> </span>debe<span class="w"> </span>estar<span class="w"> </span>definida<span class="nt">&lt;/message&gt;</span>
<span class="w">            </span><span class="nt">&lt;/constraint&gt;</span>
<span class="w">        </span><span class="nt">&lt;/field&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>

<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;edu.acceso.ejemplo.modelo.Estudiante&quot;</span><span class="w"> </span><span class="na">ignore-annotations=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nombre&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;constraint</span><span class="w"> </span><span class="na">annotation=</span><span class="s">&quot;jakarta.validation.constraints.NotNull&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;message&gt;</span>El<span class="w"> </span>nombre<span class="w"> </span>no<span class="w"> </span>puede<span class="w"> </span>ser<span class="w"> </span>nulo<span class="nt">&lt;/message&gt;</span>
<span class="w">            </span><span class="nt">&lt;/constraint&gt;</span>
<span class="w">        </span><span class="nt">&lt;/field&gt;</span>
<span class="w">        </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;centro&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;constraint</span><span class="w"> </span><span class="na">annotation=</span><span class="s">&quot;jakarta.validation.constraints.NotNull&quot;</span><span class="nt">&gt;</span>
<span class="w">                </span><span class="nt">&lt;message&gt;</span>El<span class="w"> </span>centro<span class="w"> </span>no<span class="w"> </span>puede<span class="w"> </span>ser<span class="w"> </span>nulo<span class="nt">&lt;/message&gt;</span>
<span class="w">            </span><span class="nt">&lt;/constraint&gt;</span>
<span class="w">        </span><span class="nt">&lt;/field&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/constraint-mappings&gt;</span>
</pre></div>
</div>
</div>
<p>Podemos definir otras restricciones:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jakarta.validation.constraints.Positive</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">jakarta.validation.constraints.PositiveOrZero</span></code></p></li>
<li><p>etc.</p></li>
</ul>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="10.crud/02.avanzadas/03.nativo.html"
       title="página anterior">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">anterior</p>
        <p class="prev-next-title"><span class="section-number">5.6.2.3. </span><abbr title="Structured Query Language">SQL</abbr> nativo</p>
      </div>
    </a>
    <a class="right-next"
       href="../99.ejercicios/index.html"
       title="siguiente página">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">siguiente</p>
        <p class="prev-next-title">Ejercicios</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenido
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#excepciones">5.7.1. Excepciones</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mapeo-avanzado">5.7.2. Mapeo avanzado</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cascada-de-operaciones">5.7.2.1. Cascada de operaciones</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mapeo-de-colecciones">5.7.2.2. Mapeo de colecciones</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#concurrencia">5.7.3. Concurrencia</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bloqueo-optimista">5.7.3.1. Bloqueo optimista</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#bloqueo-pesimista">5.7.3.2. Bloqueo pesimista</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#optimizacion">5.7.4. Optimización</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mapeo-mediante-archivos">5.7.5. Mapeo mediante archivos</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definicion-del-esquema">5.7.5.1. Definición del esquema</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#definicion-de-restricciones">5.7.5.2. Definición de restricciones</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Por José Miguel Sánchez Alés
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright CC BY 4.0, 2024-2025, José Miguel Sánchez Alés.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>